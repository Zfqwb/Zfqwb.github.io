

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="nitto">
  <meta name="keywords" content="">
  
  <title>JavaWeb综合案例02 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/toubudaziji.css">
<link rel="stylesheet" href="/css/gundongtiao.css">
<link rel="stylesheet" href="/css/shubiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zfqwb.github.io","root":"/","version":"1.8.9","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":21111747,"cnzz":null,"leancloud":{"app_id":"bMWk1sw4iFwEPTeRxqFOkxvq-gzGzoHsz","app_key":"sDMo4aGFa1dFrXYs2oXkNaVY","server_url":"https://bmwk1sw4.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  <meta name="baidu-site-verification" content="code-vbtyv0liY1" />
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>nitto</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="JavaWeb综合案例02">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-27 16:55" pubdate>
        2021年5月27日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      258
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JavaWeb综合案例02</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：1 个月前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="web综合案例"><a href="#web综合案例" class="headerlink" title="web综合案例"></a>web综合案例</h1><h2 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h2><p>目标1：能够说出数据库设计的三种常用范式</p>
<p>目标2：能够使用PD工具进行表结构设计</p>
<p>目标3：完成学科模块的业务开发</p>
<p>目标4：完成目录模块的业务开发</p>
<p>目标5：完成题目模块的业务开发</p>
<p>目标6：能够说出文件上传前台的三要素</p>
<p>目标7：能够完成题目选项模块的业务开发</p>
<h2 id="1-数据库设计"><a href="#1-数据库设计" class="headerlink" title="1. 数据库设计"></a>1. 数据库设计</h2><h3 id="1-1-数据库设计范式"><a href="#1-1-数据库设计范式" class="headerlink" title="1.1 数据库设计范式"></a>1.1 数据库设计范式</h3><p><strong>什么叫数据库设计范式？</strong></p>
<p><strong>范式：规范的形式，应用于各个行业的标准化</strong></p>
<p>数据库设计中有5种范式，但是常用的分别是：第一范式（1NF）,第二范式（2NF），第三范式（3NF）</p>
<p><strong>第一范式（1NF）</strong>：针对数据表中的列，列要具备原子性，不可再拆分</p>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/1.png" srcset="/img/loading.gif" lazyload></p>
<p>如果数据表这样设计，籍贯这一列不具备原子性，因为数据可再次拆分，不拆分的话无法获取用户的州郡信息或县市信息，拆分之后如下：</p>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/2.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>第二范式（2NF）</strong>：数据表要具备唯一主键，不存在多主键，使得每一行数据具有唯一性</p>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/3.png" srcset="/img/loading.gif" lazyload></p>
<p>在如图所示的表中：没有哪一个字段（列）能唯一确定一条数据，要想唯一确定一条数据，需要两个或更多的字段，这就违反了第二范式，数据表不具备唯一主键而存在多主键。</p>
<p>那如何来解决呢？在表中加一个唯一主键列：id</p>
<p><strong>第三范式（3NF）</strong>：不依赖非主键的字段及更深层次的依赖，使得每个字段都独立依赖于主键字段（独立性）</p>
<blockquote>
<p>什么叫依赖：依赖，就是在一个表中，其中某个字段的值B可以由另一个字段值A来决定，那我们称字段B依赖字段A或字段A决定字段B</p>
</blockquote>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/4.png" srcset="/img/loading.gif" lazyload></p>
<p>在如图所示的表结构中：合计列=单价 X 数量，当然这中间还需要依赖商品编号来查询商品单价</p>
<p>总而言之，合计这一列，依赖了表中的非主键字段，以及非主键字段的更深层次的依赖，这表明合计这一列的数据是冗余的，因为我们完全可以通过计算的方式得到合计数据，而不需要在表中来存储。</p>
<p><strong>反三范式</strong>：允许少量的数据冗余，提高查询的速度</p>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/5.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-2-数据库设计工具"><a href="#1-2-数据库设计工具" class="headerlink" title="1.2 数据库设计工具"></a>1.2 数据库设计工具</h3><p>PowerDesigner：简称PD，是一款功能强大的建模软件，提供强大的元数据管理功能，可以帮助用户构建关键信息的全方位视图，创建多种类型的模型，包括概念数据模型，物理数据模型，面向对象模型等等，同时集成了数据管理，BI，数据集成和数据整合多种功能。</p>
<h2 id="2-学科模块快速开发"><a href="#2-学科模块快速开发" class="headerlink" title="2. 学科模块快速开发"></a>2. 学科模块快速开发</h2><p>下面我们进行学科模块的快速开发：</p>
<p>（1）创建学科实体：com.itheima.domain.store.Course</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Course</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String remark;<br>    <span class="hljs-keyword">private</span> String state;<br>    <span class="hljs-keyword">private</span> Date createTime;<br><br>    <span class="hljs-comment">// getter/setter略</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）创建dao接口：com.itheima.dao.store.CourseDao</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseDao</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">save</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-function">Course <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-function">List&lt;Course&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）从今日课程资料中找到<code>dao层资源文件\CourseDao.xml</code>，拷贝到项目<code>src/main/resources/com/itheima/dao/store/</code>下</p>
<p>当然这个地方可以将该目录下的所有映射配置文件都拷贝到该目录下，在做后续业务时就无需在拷贝了。</p>
<p>（4）创建业务层接口：com.itheima.service.store.CourseService</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseService</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> course</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> course</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> course</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Course course)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询单个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 查询的条件（id）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 查询的结果，单个对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Course <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 全部数据的列表对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">List&lt;Course&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page 页码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size 每页显示的数据总量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（5）创建业务层实现类：com.itheima.service.store.impl.CourseServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Course course)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>            String id = UUID.randomUUID().toString();<br>            course.setId(id);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            courseDao.save(course);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Course course)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            courseDao.delete(course);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Course course)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            courseDao.update(course);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Course <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> courseDao.findById(id);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> courseDao.findAll();<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            PageHelper.startPage(page,size);<br>            List&lt;Course&gt; all = courseDao.findAll();<br>            PageInfo pageInfo = <span class="hljs-keyword">new</span> PageInfo(all);<br>            <span class="hljs-keyword">return</span> pageInfo;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（6）创建servlet：com.itheima.web.controller.store.CourseServlet</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// uri:/store/course?operation=list</span><br><span class="hljs-meta">@WebServlet(&quot;/store/course&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.list(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toAdd(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toEdit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.delete(request,response);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//进入列表页</span><br>        <span class="hljs-comment">//获取数据</span><br>        <span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> size = <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>)))&#123;<br>            page = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>)))&#123;<br>            size = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>));<br>        &#125;<br>        PageInfo all = courseService.findAll(page, size);<br>        <span class="hljs-comment">//将数据保存到指定的位置</span><br>        request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/course/list.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/course/add.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Course course = BeanUtil.fillBean(request,Course.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        courseService.save(course);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/course?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//查询要修改的数据findById</span><br>        String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>        Course course = courseService.findById(id);<br>        <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>        request.setAttribute(<span class="hljs-string">&quot;course&quot;</span>,course);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/course/update.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Course course = BeanUtil.fillBean(request,Course.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        courseService.update(course);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/course?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Course course = BeanUtil.fillBean(request,Course.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        courseService.delete(course);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/course?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doGet(request,response);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（7）修改BaseServlet，添加<code>CourseService</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> CompanyService companyService;<br>    <span class="hljs-keyword">protected</span> DeptService deptService;<br>    <span class="hljs-keyword">protected</span> UserService userService;<br>    <span class="hljs-keyword">protected</span> CourseService courseService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        companyService = <span class="hljs-keyword">new</span> CompanyServiceImpl();<br>        deptService = <span class="hljs-keyword">new</span> DeptServiceImpl();<br>        userService = <span class="hljs-keyword">new</span> UserServiceImpl();<br>        courseService = <span class="hljs-keyword">new</span> CourseServiceImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（8）创建<code>/WEB-INF/pages/store/course</code>目录，然后从今日课程资料中找到<code>模块页面\course</code>下的所有页面，拷贝到刚刚创建的目录下</p>
<p>（9）修改业务层的保存方法，添加创建时间的保存</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Course course)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        CourseDao courseDao = MapperFactory.getMapper(sqlSession,CourseDao.class);<br>        <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>        String id = UUID.randomUUID().toString();<br>        course.setId(id);<br><br>        <span class="hljs-comment">//添加创建的时间</span><br>        course.setCreateTime(<span class="hljs-keyword">new</span> Date());<br><br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        courseDao.save(course);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（10）在修改时，我们的创建时间是不允许修改的，因此我们在dao层进行update操作是去掉对创建时间的修改，找到<code>CourseDao</code>对应的持久层映射配置文件<code>CourseDao.xml</code>中的<code>update</code>，去掉创建时间即可</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置全字段更新，当提供的数据为null时，数据库数据会被更新为null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Course&quot;</span>&gt;</span><br>    update st_course<br>    set name = #&#123;name,jdbcType=VARCHAR&#125;,<br>    remark = #&#123;remark,jdbcType=VARCHAR&#125;,<br>    state = #&#123;state,jdbcType=VARCHAR&#125;<br>    where id = #&#123;id,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>（11）解决站点字符编码的问题，从今日课程资料中找到<code>web层资源文件\CharacterEncodingFilter.java</code></p>
<p>然后创建一个包<code>com.itheima.web.filters</code>，然后把该文件拷贝到该包下</p>
<p>（12）启动项目进行测试</p>
<h2 id="3-目录模块"><a href="#3-目录模块" class="headerlink" title="3. 目录模块"></a>3. 目录模块</h2><p>（1）创建目录实体：com.itheima.domain.store.Catalog</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Catalog</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String remark;<br>    <span class="hljs-keyword">private</span> String state;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> String courseId;<br><br>    <span class="hljs-keyword">private</span> Course course;<br><br>	<span class="hljs-comment">// getter/setter略</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）创建dao接口：com.itheima.dao.store.CatalogDao</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CatalogDao</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">save</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-function">Catalog <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-function">List&lt;Catalog&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）拷贝dao映射配置文件：前面已完成</p>
<p>（4）创建业务层接口：com.itheima.service.store.CatalogService</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CatalogService</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> catalog</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> catalog</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> catalog</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Catalog catalog)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询单个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 查询的条件（id）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 查询的结果，单个对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Catalog <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 全部数据的列表对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">List&lt;Catalog&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page 页码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size 每页显示的数据总量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（5）创建业务层实现类：com.itheima.service.store.impl.CatalogServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CatalogServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CatalogService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Catalog catalog)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>            String id = UUID.randomUUID().toString();<br>            catalog.setId(id);<br><br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            catalogDao.save(catalog);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Catalog catalog)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            catalogDao.delete(catalog);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Catalog catalog)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            catalogDao.update(catalog);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Catalog <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> catalogDao.findById(id);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Catalog&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> catalogDao.findAll();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            PageHelper.startPage(page, size);<br>            List&lt;Catalog&gt; all = catalogDao.findAll();<br>            PageInfo pageInfo = <span class="hljs-keyword">new</span> PageInfo(all);<br>            <span class="hljs-keyword">return</span> pageInfo;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（6）创建servlet：com.itheima.web.controller.store.CatalogServlet</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// uri:/store/catalog?operation=list</span><br><span class="hljs-meta">@WebServlet(&quot;/store/catalog&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CatalogServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.list(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toAdd(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toEdit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.delete(request,response);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//进入列表页</span><br>        <span class="hljs-comment">//获取数据</span><br>        <span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> size = <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>)))&#123;<br>            page = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>)))&#123;<br>            size = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>));<br>        &#125;<br>        PageInfo all = catalogService.findAll(page, size);<br>        <span class="hljs-comment">//将数据保存到指定的位置</span><br>        request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/catalog/list.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/catalog/add.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Catalog catalog = BeanUtil.fillBean(request,Catalog.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        catalogService.save(catalog);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/catalog?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//查询要修改的数据findById</span><br>        String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>        Catalog catalog = catalogService.findById(id);<br>        <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>        request.setAttribute(<span class="hljs-string">&quot;catalog&quot;</span>,catalog);<br><br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/catalog/update.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Catalog catalog = BeanUtil.fillBean(request,Catalog.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        catalogService.update(catalog);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/catalog?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Catalog catalog = BeanUtil.fillBean(request,Catalog.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        catalogService.delete(catalog);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/catalog?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doGet(request,response);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（7）修改BaseServlet，添加<code>CatalogService</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> CompanyService companyService;<br>    <span class="hljs-keyword">protected</span> DeptService deptService;<br>    <span class="hljs-keyword">protected</span> UserService userService;<br>    <span class="hljs-keyword">protected</span> CourseService courseService;<br>    <span class="hljs-keyword">protected</span> CatalogService catalogService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        companyService = <span class="hljs-keyword">new</span> CompanyServiceImpl();<br>        deptService = <span class="hljs-keyword">new</span> DeptServiceImpl();<br>        userService = <span class="hljs-keyword">new</span> UserServiceImpl();<br>        courseService = <span class="hljs-keyword">new</span> CourseServiceImpl();<br>        catalogService = <span class="hljs-keyword">new</span> CatalogServiceImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（8）创建页面存放目录<code>/WEB-INF/pages/store/catalog</code>，然后从今日课程资料中找到<code>模块页面\catalog</code>下的所有页面到该目录</p>
<p>（9）修改servlet代码，找到<code>toAdd</code>方法，在去添加页面之前查询所有的学科数据</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//加载学科信息</span><br>    List&lt;Course&gt; all = courseService.findAll();<br>    request.setAttribute(<span class="hljs-string">&quot;courseList&quot;</span>,all);<br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/catalog/add.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（10）保存目录的时候要保存创建时间，修改业务层的save方法，添加对创建时间的保存</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Catalog catalog)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        CatalogDao catalogDao = MapperFactory.getMapper(sqlSession, CatalogDao.class);<br>        <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>        String id = UUID.randomUUID().toString();<br>        catalog.setId(id);<br>        catalog.setCreateTime(<span class="hljs-keyword">new</span> Date());<br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        catalogDao.save(catalog);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（11）修改servlet代码，找到<code>toEdit</code>方法，去到编辑页面之前查询所有的学科信息，</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//查询要修改的数据findById</span><br>    String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>    Catalog catalog = catalogService.findById(id);<br>    <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>    request.setAttribute(<span class="hljs-string">&quot;catalog&quot;</span>,catalog);<br><br>    <span class="hljs-comment">//加载学科信息</span><br>    List&lt;Course&gt; all = courseService.findAll();<br>    request.setAttribute(<span class="hljs-string">&quot;courseList&quot;</span>,all);<br><br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/catalog/update.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（12）启动项目，进行测试</p>
<h2 id="4-题目模块"><a href="#4-题目模块" class="headerlink" title="4. 题目模块"></a>4. 题目模块</h2><h3 id="4-1-题目模块快速开发"><a href="#4-1-题目模块快速开发" class="headerlink" title="4.1 题目模块快速开发"></a>4.1 题目模块快速开发</h3><p>（1）创建题目实体：com.itheima.domain.store.Question</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Question</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String id;			<span class="hljs-comment">//题目ID</span><br><br>    <span class="hljs-keyword">private</span> String companyId;	<span class="hljs-comment">//所属企业</span><br>    <span class="hljs-keyword">private</span> String catalogId;	<span class="hljs-comment">//题目所属目录ID</span><br><br>    <span class="hljs-keyword">private</span> String remark;		<span class="hljs-comment">//题目简介</span><br><br>    <span class="hljs-keyword">private</span> String subject;     <span class="hljs-comment">//题干</span><br><br>    <span class="hljs-keyword">private</span> String analysis;	<span class="hljs-comment">//题目分析</span><br><br>    <span class="hljs-keyword">private</span> String type;       	<span class="hljs-comment">//题目类型  1:单选，2：多选，3：简答</span><br>    <span class="hljs-keyword">private</span> String difficulty; 	<span class="hljs-comment">//难易程度： 1极易 2容易 3普通  4困难  5极难</span><br><br>    <span class="hljs-keyword">private</span> String isClassic; 	<span class="hljs-comment">//是否经典面试题 0：否 1：是</span><br>    <span class="hljs-keyword">private</span> String state;   	<span class="hljs-comment">//题目状态  0：不可用  1：可用（只有审核通过的题目才可以设置）</span><br><br>    <span class="hljs-keyword">private</span> String reviewStatus;<span class="hljs-comment">//审核状态  -1 审核不通过  0 审核中   1 审核通过</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <br>    <span class="hljs-keyword">private</span> Company company;<br>    <span class="hljs-keyword">private</span> Catalog catalog;<br>    <br>	<span class="hljs-comment">// getter/setter 略</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）创建dao接口：com.itheima.dao.store.QuestionDao</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionDao</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-function">Question <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-function">List&lt;Question&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）添加题目dao的映射配置文件，之前已操作，略</p>
<p>（4）创建业务层接口：com.itheima.service.store.QuestionService</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionService</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Question question)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询单个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 查询的条件（id）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 查询的结果，单个对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Question <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 全部数据的列表对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">List&lt;Question&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page 页码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size 每页显示的数据总量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（5）创建业务层实现类：com.itheima.service.store.impl.QuestionServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">QuestionService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>            String id = UUID.randomUUID().toString();<br>            question.setId(id);<br><br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionDao.save(question);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Question question)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionDao.delete(question);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Question question)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionDao.update(question);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Question <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> questionDao.findById(id);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Question&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> questionDao.findAll();<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            PageHelper.startPage(page,size);<br>            List&lt;Question&gt; all = questionDao.findAll();<br>            PageInfo pageInfo = <span class="hljs-keyword">new</span> PageInfo(all);<br>            <span class="hljs-keyword">return</span> pageInfo;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（6）创建servlet：com.itheima.web.controller.store.QuestionServlet</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// uri:/store/question?operation=list</span><br><span class="hljs-meta">@WebServlet(&quot;/store/question&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.list(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toAdd(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toEdit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.delete(request,response);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//进入列表页</span><br>        <span class="hljs-comment">//获取数据</span><br>        <span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> size = <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>)))&#123;<br>            page = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>)))&#123;<br>            size = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>));<br>        &#125;<br>        PageInfo all = questionService.findAll(page, size);<br>        <span class="hljs-comment">//将数据保存到指定的位置</span><br>        request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/list.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/add.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(request,Question.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.save(question);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//查询要修改的数据findById</span><br>        String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>        Question question = questionService.findById(id);<br>        <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>        request.setAttribute(<span class="hljs-string">&quot;question&quot;</span>,question);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/update.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(request,Question.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.update(question);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        <span class="hljs-comment">//list(request,response);</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(request,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.delete(question);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doGet(request,response);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（7）修改BaserServlet，添加<code>QuestionService</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> CompanyService companyService;<br>    <span class="hljs-keyword">protected</span> DeptService deptService;<br>    <span class="hljs-keyword">protected</span> UserService userService;<br>    <span class="hljs-keyword">protected</span> CourseService courseService;<br>    <span class="hljs-keyword">protected</span> CatalogService catalogService;<br>    <span class="hljs-keyword">protected</span> QuestionService questionService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        companyService = <span class="hljs-keyword">new</span> CompanyServiceImpl();<br>        deptService = <span class="hljs-keyword">new</span> DeptServiceImpl();<br>        userService = <span class="hljs-keyword">new</span> UserServiceImpl();<br>        courseService = <span class="hljs-keyword">new</span> CourseServiceImpl();<br>        catalogService = <span class="hljs-keyword">new</span> CatalogServiceImpl();<br>        questionService = <span class="hljs-keyword">new</span> QuestionServiceImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（8）创建页面存放目录,<code>/WEB-INF/pages/store/question</code>，从今日课程资料中找到<code>模块页面\question</code>，将下面的所有页面拷贝到该目录下</p>
<p>（9）修改servlet，找到<code>toAdd</code>方法，去添加页面之前查询企业和目录数据</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    List&lt;Company&gt; companyList = companyService.findAll();<br>    List&lt;Catalog&gt; catalogList = catalogService.findAll();<br>    request.setAttribute(<span class="hljs-string">&quot;companyList&quot;</span>,companyList);<br>    request.setAttribute(<span class="hljs-string">&quot;catalogList&quot;</span>,catalogList);<br><br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/add.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>找到<code>toEdit</code>方法，去修改页面之前查询企业和目录数据</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//查询要修改的数据findById</span><br>    String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>    Question question = questionService.findById(id);<br>    <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>    request.setAttribute(<span class="hljs-string">&quot;question&quot;</span>,question);<br><br>    List&lt;Company&gt; companyList = companyService.findAll();<br>    List&lt;Catalog&gt; catalogList = catalogService.findAll();<br>    request.setAttribute(<span class="hljs-string">&quot;companyList&quot;</span>,companyList);<br>    request.setAttribute(<span class="hljs-string">&quot;catalogList&quot;</span>,catalogList);<br><br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/update.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（10）修改业务层代码，找到添加数据的方法，需要新增审核状态和创建时间的数据</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>        <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>        String id = UUID.randomUUID().toString();<br>        question.setId(id);<br><br>        <span class="hljs-comment">//设置新创建的题目默认的审核状态为未审核（0）</span><br>        question.setReviewStatus(<span class="hljs-string">&quot;0&quot;</span>);<br>        question.setCreateTime(<span class="hljs-keyword">new</span> Date());<br><br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        questionDao.save(question);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（11）修改查询所有数据时的排序，修改对应的dao映射配置文件<code>QuestionDao.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置查询所有，带条件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>    select<br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>/&gt;</span><br>    from st_question<br>    order by create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>（12）在进行数据修改时，有些数据是不能修改的，我们可以在持久层映射配置文件中进行控制</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置全字段更新，当提供的数据为null时，数据库数据会被更新为null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    update<br>    st_question<br>    set<br>    company_id = #&#123;companyId,jdbcType=VARCHAR&#125;,<br>    catalog_id = #&#123;catalogId,jdbcType=VARCHAR&#125;,<br>    remark = #&#123;remark,jdbcType=VARCHAR&#125;,<br>    subject = #&#123;subject,jdbcType=VARCHAR&#125;,<br>    analysis = #&#123;analysis,jdbcType=VARCHAR&#125;,<br>    difficulty = #&#123;difficulty,jdbcType=VARCHAR&#125;,<br>    is_classic = #&#123;isClassic,jdbcType=VARCHAR&#125;,<br>    state = #&#123;state,jdbcType=VARCHAR&#125;<br>    where<br>    id = #&#123;id,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>



<h3 id="4-2-文件上传基础演示"><a href="#4-2-文件上传基础演示" class="headerlink" title="4.2 文件上传基础演示"></a>4.2 文件上传基础演示</h3><p>文件上传功能需要前台功能和后台功能共同配合完成</p>
<p><strong>前台</strong>：文件上传的三要素</p>
<ul>
<li>页面提供文件上传的表单元素</li>
</ul>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/6.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>form表单enctype属性的值为<code>multipart/form-data</code></li>
</ul>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/7.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>表单的提交方式必须是<code>POST</code>，get方式无法提交大量的数据</li>
</ul>
<p><strong>后台</strong>：可以使用的技术有很多，在此处我们使用apache提供的commons-fileupload组件完成文件上次操作，后台的操作步骤如下</p>
<ul>
<li>确认请求操作是否支持文件上传</li>
<li>创建磁盘工厂对象，用于将页面上传的文件保存到磁盘中</li>
<li>获取servet文件上传核心对象</li>
<li>读取数据</li>
<li>对读取到数据中的文件表单进行操作，并将内容写到指定位置</li>
</ul>
<p>下面我们开始进行文件上传的演示：</p>
<p>（1）从今日课程资料找到<code>文件下载\testFileUpload.jsp</code>文件上传页面，将其添加到项目<code>/WEB-INF/pages/store/question目录下</code></p>
<p>（2）在question目录下的list.jsp页面上添加一个新的按钮，点击该按钮跳转到文件上传页面</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;测试文件上传&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&#x27;location.href=&quot;$&#123;ctx&#125;/store/question?operation=toTestUpload&quot;&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-file-o&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 测试文件上传<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>（3）在<code>QuestionServlet</code>中添加<code>toTestUpload</code>方法，跳转到文件上传页面</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/store/question&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.list(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toAdd(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toEdit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.delete(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toTestUpload&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toTestUpload(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;testUpload&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">this</span>.testUpload(request,response);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toTestUpload</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/question/testFileUpload.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpload</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>      <br>    &#125;<br>&#125;   <br></code></pre></div></td></tr></table></figure>

<p>（4）完成文件上传的后台代码</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpload</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),item.getName()));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>需要在项目<code>webapp</code>目录下创建一个upload目录用于存储上传过来的文件</p>
<p>（5）启动测试</p>
<h3 id="4-3-添加题目时加入文件上传"><a href="#4-3-添加题目时加入文件上传" class="headerlink" title="4.3 添加题目时加入文件上传"></a>4.3 添加题目时加入文件上传</h3><p>（1）在题目实体中添加图片的属性</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Question</span> </span>&#123;<br>	<span class="hljs-comment">// 其他属性略</span><br>    <span class="hljs-keyword">private</span> String picture;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPicture</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> picture;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPicture</span><span class="hljs-params">(String picture)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.picture = picture;<br>    &#125;<br>&#125;    <br></code></pre></div></td></tr></table></figure>

<p>（2）在对应的dao映射配置文件中添加图片字段的配置，在<code>resultMap，查询的sql片段，保存，更新</code>几个位置添加映射配置即可，更新的时候是不需要更改图片的名称，因此是去掉对图片名称的更新</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置实体类属性和数据库表中列的对应关系--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;company_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;companyId&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;catalog_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;catalogId&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;remark&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;subject&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;subject&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;analysis&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;analysis&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;type&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;type&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;difficulty&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;difficulty&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;is_classic&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;isClassic&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;state&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;state&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;review_status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;reviewStatus&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;picture&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;picture&quot;</span>/&gt;</span><br>    &lt;association<br>                 property=&quot;company&quot;<br>                 column=&quot;company_id&quot;<br>                 javaType=&quot;com.itheima.domain.store.Course&quot;<br>                 select=&quot;com.itheima.dao.store.CompanyDao.findById&quot;/&gt;<br>    &lt;association<br>                 property=&quot;catalog&quot;<br>                 column=&quot;catalog_id&quot;<br>                 javaType=&quot;com.itheima.domain.store.Course&quot;<br>                 select=&quot;com.itheima.dao.store.CatalogDao.findById&quot;<br>                 /&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-comment">&lt;!--配置查询的列名公共SQL语句--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>&gt;</span><br>    id, catalog_id, company_id, remark,subject,analysis,type, difficulty, is_classic,<br>    state, review_status, create_time, picture<br><span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><br><span class="hljs-comment">&lt;!--配置全字段插入，当某个字段没有值时，插入null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    insert into st_question(id, company_id, catalog_id, remark, subject, analysis, type,<br>    difficulty, is_classic, state, review_status, create_time ,picture )<br>    values (#&#123;id,jdbcType=VARCHAR&#125;, #&#123;companyId,jdbcType=VARCHAR&#125;, #&#123;catalogId,jdbcType=VARCHAR&#125;,<br>    #&#123;remark,jdbcType=VARCHAR&#125;, #&#123;subject,jdbcType=VARCHAR&#125;, #&#123;analysis,jdbcType=VARCHAR&#125;,<br>    #&#123;type,jdbcType=VARCHAR&#125;, #&#123;difficulty,jdbcType=VARCHAR&#125;, #&#123;isClassic,jdbcType=VARCHAR&#125;,<br>    #&#123;state,jdbcType=VARCHAR&#125;, #&#123;reviewStatus,jdbcType=VARCHAR&#125;, #&#123;createTime,jdbcType=TIMESTAMP&#125;,<br>    #&#123;picture,jdbcType=VARCHAR&#125; )<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-comment">&lt;!--配置全字段更新，当提供的数据为null时，数据库数据会被更新为null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    update<br>    st_question<br>    set<br>    company_id = #&#123;companyId,jdbcType=VARCHAR&#125;,<br>    catalog_id = #&#123;catalogId,jdbcType=VARCHAR&#125;,<br>    remark = #&#123;remark,jdbcType=VARCHAR&#125;,<br>    subject = #&#123;subject,jdbcType=VARCHAR&#125;,<br>    analysis = #&#123;analysis,jdbcType=VARCHAR&#125;,<br>    difficulty = #&#123;difficulty,jdbcType=VARCHAR&#125;,<br>    is_classic = #&#123;isClassic,jdbcType=VARCHAR&#125;,<br>    state = #&#123;state,jdbcType=VARCHAR&#125;<br>    where<br>    id = #&#123;id,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>（3）在question模块的添加页面<code>add.jsp</code>中加入图片上传的表单项</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp"><br>&lt;form id=<span class="hljs-string">&quot;editForm&quot;</span> action=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/question?operation=save&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;<br>    &lt;!--其他元素略--&gt;<br>    <br>    &lt;div class=&quot;col-md-2 title&quot;&gt;题干图片&lt;/div&gt;&lt;!--放到题干后面--&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-10 data &quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> placeholder=<span class="hljs-string">&quot;题干图片&quot;</span> name=<span class="hljs-string">&quot;picture&quot;</span>&gt;<br>    &lt;/div&gt;<br>    <br>&lt;/form&gt;<br></code></pre></div></td></tr></table></figure>

<p>（4）在servlet中修改保存题目的方法<code>save</code>，首先要更改的就是接收数据的方式，我们要按照文件上传的形式来接收</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.list(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toAdd(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toEdit(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.edit(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.delete(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toTestUpload&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toTestUpload(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;testUpload&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">this</span>.testUpload(request,response);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br>        <span class="hljs-comment">// --处理form表单提交过来的普通数据</span><br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(fileItems,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.save(question);<br><br>        <span class="hljs-comment">// --处理form表单提交过来的文件数据</span><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),item.getName()));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h3 id="4-4-文件上传的重名问题"><a href="#4-4-文件上传的重名问题" class="headerlink" title="4.4 文件上传的重名问题"></a>4.4 文件上传的重名问题</h3><p>（1）在question模块的<code>list.jsp</code>页面中添加对图片名称的展示</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;!--数据列表--&gt;<br>&lt;table id=<span class="hljs-string">&quot;dataList&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;table table-bordered table-striped table-hover dataTable&quot;</span>&gt;<br>    &lt;thead&gt;<br>        &lt;tr&gt;<br>            &lt;th <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;&quot;</span> style=<span class="hljs-string">&quot;padding-right:0px;&quot;</span>&gt;<br>                &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;selid&quot;</span> onclick=<span class="hljs-string">&quot;checkAll(&#x27;id&#x27;,this)&quot;</span>&gt;<br>            &lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;图片&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;企业&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;类别&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;题目&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;类型&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;难度&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;经典面试题&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;状态&lt;/th&gt;<br>            &lt;th class=&quot;sorting&quot;&gt;审核结果&lt;/th&gt;<br>            &lt;th class=&quot;text-center&quot;&gt;操作&lt;/th&gt;<br>        &lt;/tr&gt;<br>    &lt;/thead&gt;<br>    &lt;tbody&gt;<br>        &lt;c:forEach items=<span class="hljs-string">&quot;$&#123;page.list&#125;&quot;</span> <span class="hljs-keyword">var</span>=<span class="hljs-string">&quot;o&quot;</span> varStatus=<span class="hljs-string">&quot;status&quot;</span>&gt;<br>            &lt;tr <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;odd&quot;</span> onmouseover=<span class="hljs-string">&quot;this.className=&#x27;highlight&#x27;&quot;</span> onmouseout=<span class="hljs-string">&quot;this.className=&#x27;odd&#x27;&quot;</span> &gt;<br>                &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;id&quot; value=&quot;$&#123;o.id&#125;&quot;/&gt;&lt;/td&gt;<br>                &lt;td&gt;$&#123;o.picture&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;o.company.name&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;o.catalog.name&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;o.subject&#125;&lt;/td&gt;<br>                &lt;td&gt;<br>                    &lt;c:choose&gt;<br>                        &lt;c:when test=&quot;$&#123;o.type eq &#x27;1&#x27;&#125;&quot;&gt;单选&lt;/c:when&gt;<br>                        &lt;c:when test=&quot;$&#123;o.type eq &#x27;2&#x27;&#125;&quot;&gt;多选&lt;/c:when&gt;<br>                        &lt;c:when test=&quot;$&#123;o.type eq &#x27;3&#x27;&#125;&quot;&gt;简答&lt;/c:when&gt;<br>                    &lt;/c:choose&gt;<br>                &lt;/td&gt;<br>                &lt;td&gt;<br>                    &lt;c:forEach begin=<span class="hljs-string">&quot;1&quot;</span> end=<span class="hljs-string">&quot;$&#123;o.difficulty&#125;&quot;</span>&gt;<br>                        ★<br>                    &lt;/c:forEach&gt;<br>                &lt;/td&gt;<br>                &lt;td&gt;$&#123;o.isClassic eq &quot;1&quot; ? &quot;经典题&quot;:&quot;普通题&quot;&#125;&lt;/td&gt;<br>                &lt;td&gt;$&#123;o.state eq &quot;1&quot; ? &quot;&lt;font color=&#x27;green&#x27;&gt;启用&lt;/font&gt;&quot; : &quot;&lt;font color=&#x27;red&#x27;&gt;禁用&lt;/font&gt;&quot;&#125;&lt;/td&gt;<br>                &lt;td&gt;<br>                    &lt;c:choose&gt;<br>                        &lt;c:when test=&quot;$&#123;o.reviewStatus eq &#x27;1&#x27;&#125;&quot;&gt;&lt;font color=&quot;green&quot;&gt;审核通过&lt;/font&gt;&lt;/c:when&gt;<br>                        &lt;c:when test=&quot;$&#123;o.reviewStatus eq &#x27;0&#x27;&#125;&quot;&gt;审核中&lt;/c:when&gt;<br>                        &lt;c:when test=&quot;$&#123;o.reviewStatus eq &#x27;-1&#x27;&#125;&quot;&gt;&lt;font color=&quot;red&quot;&gt;审核不通过&lt;/font&gt;&lt;/c:when&gt;<br>                    &lt;/c:choose&gt;<br>                &lt;/td&gt;<br>                &lt;th <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;text-center&quot;</span>&gt;<br>                    &lt;button type=&quot;button&quot; class=&quot;btn bg-olive btn-xs&quot; onclick=&#x27;location.href=&quot;$&#123;ctx&#125;/store/question?operation=toEdit&amp;id=$&#123;o.id&#125;&quot;&#x27;&gt;编辑&lt;/button&gt;<br>                    &lt;button type=&quot;button&quot; class=&quot;btn bg-olive btn-xs&quot; onclick=&#x27;location.href=&quot;$&#123;ctx&#125;/store/question?operation=toExamine&amp;id=$&#123;o.id&#125;&quot;&#x27;&gt;审核&lt;/button&gt;<br>                &lt;/th&gt;<br>            &lt;/tr&gt;<br>        &lt;/c:forEach&gt;<br>    &lt;/tbody&gt;<br>&lt;/table&gt;<br></code></pre></div></td></tr></table></figure>



<p>文件上传的常见问题：<strong>文件重名问题</strong></p>
<p>（1）修改业务层接口<code>QuestionService</code>的保存方法，添加返回值，将图片的名称返回</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 保存的图片名称</span><br><span class="hljs-comment">     */</span><br><span class="hljs-function">String <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>（2）修改实现类，添加对图片名称的存储及返回图片的名称，图片名称使用该条数据的id</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">save</span><span class="hljs-params">(Question question)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>        <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>        String id = UUID.randomUUID().toString();<br>        question.setId(id);<br><br>        <span class="hljs-comment">//设置新创建的题目默认的审核状态为未审核（0）</span><br>        question.setReviewStatus(<span class="hljs-string">&quot;0&quot;</span>);<br>        question.setCreateTime(<span class="hljs-keyword">new</span> Date());<br>        <span class="hljs-comment">//设置当前存储的图片名称为id值</span><br>        question.setPicture(id);<br><br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        questionDao.save(question);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）在servlet中的<code>save</code>方法中接收图片名称</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br>        <span class="hljs-comment">// --处理form表单提交过来的普通数据</span><br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(fileItems,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        String picture = questionService.save(question);<br><br>        <span class="hljs-comment">// --处理form表单提交过来的文件数据</span><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),picture));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h3 id="4-5-修改题目时加入文件上传"><a href="#4-5-修改题目时加入文件上传" class="headerlink" title="4.5 修改题目时加入文件上传"></a>4.5 修改题目时加入文件上传</h3><p>修改之前需要先将图片展示出来</p>
<p>（1）在<code>question</code>模块的<code>update.jsp</code>页面中添加图片的展示，同时把修改时上传图片的表单项添加进去，以及表单也要配套修改</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form id=<span class="hljs-string">&quot;editForm&quot;</span> action=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/question?operation=edit&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;<br>		&lt;!--其他省略--&gt;<br>   <br>            &lt;div class=&quot;col-md-2 title&quot;&gt;题干图片&lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-10 data &quot;</span>&gt;<br>                &lt;input type=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> placeholder=<span class="hljs-string">&quot;题干图片&quot;</span> name=<span class="hljs-string">&quot;picture&quot;</span> value=<span class="hljs-string">&quot;$&#123;question.picture&#125;&quot;</span>&gt;<br>            &lt;/div&gt;<br><br>            &lt;div class=&quot;col-md-2 title&quot;&gt;题干图片&lt;/div&gt;<br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-10 data &quot;</span>&gt;<br>                &lt;img src=<span class="hljs-string">&quot;$&#123;ctx&#125;/upload/$&#123;question.picture&#125;&quot;</span>/&gt;<br>            &lt;/div&gt;<br><br>           <br>&lt;/form&gt;<br></code></pre></div></td></tr></table></figure>

<p>（2）修改后台的servlet，找到<code>edit</code>方法进行修改</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.list(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toAdd(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toEdit(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.delete(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toTestUpload&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toTestUpload(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;testUpload&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">this</span>.testUpload(request,response);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br>        <span class="hljs-comment">// --处理form表单提交过来的普通数据</span><br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(fileItems,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.update(question);<br><br>        <span class="hljs-comment">// --处理form表单提交过来的文件数据</span><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),question.getId()));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）业务层实现类的<code>update</code>方法在进行数据修改时，图片名称不需要修改，这个我们在持久层的update操作时去掉对图片的更改，我们改一下对应的映射配置文件（这步操作之前已完成）如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置全字段更新，当提供的数据为null时，数据库数据会被更新为null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    update<br>    st_question<br>    set<br>    company_id = #&#123;companyId,jdbcType=VARCHAR&#125;,<br>    catalog_id = #&#123;catalogId,jdbcType=VARCHAR&#125;,<br>    remark = #&#123;remark,jdbcType=VARCHAR&#125;,<br>    subject = #&#123;subject,jdbcType=VARCHAR&#125;,<br>    analysis = #&#123;analysis,jdbcType=VARCHAR&#125;,<br>    difficulty = #&#123;difficulty,jdbcType=VARCHAR&#125;,<br>    is_classic = #&#123;isClassic,jdbcType=VARCHAR&#125;,<br>    state = #&#123;state,jdbcType=VARCHAR&#125;<br>    where<br>    id = #&#123;id,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>



<h3 id="4-6-兼容图片上传可选操作与显示问题"><a href="#4-6-兼容图片上传可选操作与显示问题" class="headerlink" title="4.6 兼容图片上传可选操作与显示问题"></a>4.6 兼容图片上传可选操作与显示问题</h3><p><strong>问题</strong>：</p>
<p>如果在新增的时候没有选择上传图片，会导致在修改的时候页面上展示不出图片，如下图所示</p>
<p><img src="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B02/img/8.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>产生问题的原因：</strong></p>
<p>新增的时候虽然没有上传图片，但是由于我们保存数据的时候默认是将数据的id作为图片的名称，所以在展示的时候会去找这个名称的图片，但是我们又没上传因此会找到不到</p>
<p><strong>改进方法：</strong></p>
<p>在新增时做一个判断，如果上传了图片再去保存图片的名称，没有上传则不保存图片的名称</p>
<p>（1）在servlet的<code>add</code>方法中去判断当前是否上传文件，可以用一个布尔值标记来表明是否有文件上传，同时在业务层执行保存操作时可以把这个是否有图片的标记传递过去</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br><br>        <span class="hljs-comment">//创建一个标记位,标记当前时候有上传文件的操作</span><br>        <span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">for</span>(FileItem item :fileItems)&#123;<br>            <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(item.getName()))&#123;<br>                flag = <span class="hljs-keyword">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// --处理form表单提交过来的普通数据</span><br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(fileItems,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        String picture = questionService.save(question , flag);<br><br>        <span class="hljs-comment">// --处理form表单提交过来的文件数据</span><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),picture));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）修改业务层接口方法<code>save</code>，添加参数</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> flag 是否有上传文件的操作</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 保存的图片名称</span><br><span class="hljs-comment">     */</span><br><span class="hljs-function">String <span class="hljs-title">save</span><span class="hljs-params">(Question question,<span class="hljs-keyword">boolean</span> flag)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>（3）修改对应的接口实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">save</span><span class="hljs-params">(Question question,<span class="hljs-keyword">boolean</span> flag)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br>        <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>        String id = UUID.randomUUID().toString();<br>        question.setId(id);<br>        <span class="hljs-comment">//设置新创建的题目默认的审核状态为未审核（0）</span><br>        question.setReviewStatus(<span class="hljs-string">&quot;0&quot;</span>);<br>        question.setCreateTime(<span class="hljs-keyword">new</span> Date());<br>        <span class="hljs-comment">//检测到前端上传文件了，记录文件名，否则不记录</span><br>        <span class="hljs-keyword">if</span>(flag) &#123;<br>            <span class="hljs-comment">//设置当前存储的图片名称为id值</span><br>            question.setPicture(id);<br>        &#125;<br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        questionDao.save(question);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（4）在修改时，如果没有图片则不显示图片，有图片信息的时候再显示，我们可以使用<code>&lt;c:if&gt;</code>进行判断</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;div class=&quot;col-md-2 title&quot;&gt;题干图片&lt;/div&gt;<br>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-10 data &quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> placeholder=<span class="hljs-string">&quot;题干图片&quot;</span> name=<span class="hljs-string">&quot;picture&quot;</span> value=<span class="hljs-string">&quot;$&#123;question.picture&#125;&quot;</span>&gt;<br>&lt;/div&gt;<br><br>&lt;c:<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;$&#123;question.picture.length() &gt; 0&#125;&quot;</span>&gt;<br>    &lt;div class=&quot;col-md-2 title&quot;&gt;题干图片&lt;/div&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-10 data &quot;</span>&gt;<br>        &lt;img src=<span class="hljs-string">&quot;$&#123;ctx&#125;/upload/$&#123;question.picture&#125;&quot;</span>/&gt;<br>    &lt;/div&gt;<br>&lt;/c:if&gt;<br></code></pre></div></td></tr></table></figure>

<p>（5）页面修改完成后，在进行真正的修改操作时，我们同样需要进行判断，如果上传了图片则进行修改，否则不进行修改。</p>
<p>找到后台的servlet的<code>edit</code>方法，做出如下修改</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.确认该操作是否支持文件上传操作，enctype=&quot;multipart/form-data&quot;</span><br>    <span class="hljs-keyword">if</span>(ServletFileUpload.isMultipartContent(request))&#123;<br>        <span class="hljs-comment">//2.创建磁盘工厂对象</span><br>        DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>        <span class="hljs-comment">//3.Servlet文件上传核心对象</span><br>        ServletFileUpload fileUpload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>        <span class="hljs-comment">//4.从request中读取数据</span><br>        List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);<br>        <span class="hljs-comment">//创建一个标记位,标记当前时候有上传文件的操作</span><br>        <span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">for</span>(FileItem item :fileItems)&#123;<br>            <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(item.getName()))&#123;<br>                flag = <span class="hljs-keyword">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// --处理form表单提交过来的普通数据</span><br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        Question question = BeanUtil.fillBean(fileItems,Question.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionService.update(question , flag);<br>        <span class="hljs-comment">// --处理form表单提交过来的文件数据</span><br>        <span class="hljs-keyword">for</span>(FileItem item : fileItems)&#123;<br>            <span class="hljs-comment">//5.当前表单是否是文件表单</span><br>            <span class="hljs-keyword">if</span>(!item.isFormField())&#123;<br>                <span class="hljs-comment">//6.从临时存储文件的地方将内容写入到指定位置</span><br>                item.write(<span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;upload&quot;</span>),question.getId()));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/question?operation=list&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（6）同样需要修改业务层接口，在<code>update</code>方法上添加是否修改图片的参数</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> question</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> flag 是否有上传文件的操作</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Question question,<span class="hljs-keyword">boolean</span> flag)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>（7）在业务层实现类中修改该方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Question question, <span class="hljs-keyword">boolean</span> flag)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        QuestionDao questionDao = MapperFactory.getMapper(sqlSession,QuestionDao.class);<br><br>        <span class="hljs-comment">//检测到前端上传文件了，记录文件名，否则不记录</span><br>        <span class="hljs-keyword">if</span>(flag) &#123;<br>            <span class="hljs-comment">//设置当前存储的图片名称为id值</span><br>            question.setPicture(question.getId());<br>        &#125;<br><br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        questionDao.update(question);<br>        <span class="hljs-comment">//4.提交事务</span><br>        TransactionUtil.commit(sqlSession);<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        TransactionUtil.rollback(sqlSession);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（8）在持久层dao真正进行update操作的时候我们把对图片的更新添加进去，我们去修改对应的映射配置文件即可</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置全字段更新，当提供的数据为null时，数据库数据会被更新为null--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.itheima.domain.store.Question&quot;</span>&gt;</span><br>    update<br>    st_question<br>    set<br>    company_id = #&#123;companyId,jdbcType=VARCHAR&#125;,<br>    catalog_id = #&#123;catalogId,jdbcType=VARCHAR&#125;,<br>    remark = #&#123;remark,jdbcType=VARCHAR&#125;,<br>    subject = #&#123;subject,jdbcType=VARCHAR&#125;,<br>    analysis = #&#123;analysis,jdbcType=VARCHAR&#125;,<br>    difficulty = #&#123;difficulty,jdbcType=VARCHAR&#125;,<br>    is_classic = #&#123;isClassic,jdbcType=VARCHAR&#125;,<br>    picture = #&#123;picture,jdbcType=VARCHAR&#125;,<br>    state = #&#123;state,jdbcType=VARCHAR&#125;<br>    where<br>    id = #&#123;id,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h2 id="5-题目选项模块"><a href="#5-题目选项模块" class="headerlink" title="5. 题目选项模块"></a>5. 题目选项模块</h2><h3 id="5-1-列表页制作"><a href="#5-1-列表页制作" class="headerlink" title="5.1 列表页制作"></a>5.1 列表页制作</h3><p>（1）创建题目选项实体：com.itheima.domain.store.QuestionItem</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionItem</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String id;          	<span class="hljs-comment">//ID</span><br>    <span class="hljs-keyword">private</span> String questionId;  <span class="hljs-comment">//题目ID</span><br>    <span class="hljs-keyword">private</span> String content;     <span class="hljs-comment">//选项内容</span><br>    <span class="hljs-keyword">private</span> String picture;      <span class="hljs-comment">//选项图片</span><br>    <span class="hljs-keyword">private</span> String isRight;    <span class="hljs-comment">//是否正确答案</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;QuestionItem&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&#x27;&quot;</span> + id + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, questionId=&#x27;&quot;</span> + questionId + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, content=&#x27;&quot;</span> + content + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, picture=&#x27;&quot;</span> + picture + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, isRight=&#x27;&quot;</span> + isRight + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>	<span class="hljs-comment">// getter/setter方法略</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）创建dao接口：com.itheima.dao.store.QuestionItemDao</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionItemDao</span> </span>&#123;<br> 	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">save</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-function">QuestionItem <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-function">List&lt;QuestionItem&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）添加对应的映射配置文件，之前已导入过了</p>
<p>（4）创建业务层接口：com.itheima.service.store.QuestionItemService</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionItemService</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 添加</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> questionItem</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> questionItem</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> questionItem</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(QuestionItem questionItem)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询单个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 查询的条件（id）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 查询的结果，单个对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">QuestionItem <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 全部数据的列表对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">List&lt;QuestionItem&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page 页码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size 每页显示的数据总量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（5）创建业务层实现类：com.itheima.service.store.impl.QuestionItemServiceImpl</p>
<p>我们基于<code>CompanyServiceImpl</code>拷贝然后改造</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionItemServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">QuestionItemService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(QuestionItem questionItem)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//id使用UUID的生成策略来获取</span><br>            String id = UUID.randomUUID().toString();<br>            questionItem.setId(id);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionItemDao.save(questionItem);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(QuestionItem questionItem)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionItemDao.delete(questionItem);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(QuestionItem questionItem)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            questionItemDao.update(questionItem);<br>            <span class="hljs-comment">//4.提交事务</span><br>            TransactionUtil.commit(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            TransactionUtil.rollback(sqlSession);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> QuestionItem <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> questionItemDao.findById(id);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;QuestionItem&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            <span class="hljs-keyword">return</span> questionItemDao.findAll();<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//1.获取SqlSession</span><br>            sqlSession = MapperFactory.getSqlSession();<br>            <span class="hljs-comment">//2.获取Dao</span><br>            QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>            <span class="hljs-comment">//3.调用Dao层操作</span><br>            PageHelper.startPage(page,size);<br>            List&lt;QuestionItem&gt; all = questionItemDao.findAll();<br>            PageInfo pageInfo = <span class="hljs-keyword">new</span> PageInfo(all);<br>            <span class="hljs-keyword">return</span> pageInfo;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>            <span class="hljs-comment">//记录日志</span><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                TransactionUtil.close(sqlSession);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（6）创建servlet：com.itheima.web.controller.store.QuestionItemServlet</p>
<p>基于<code>CompanyServlet</code>拷贝进行改造（修改完成后有些方法其实没有用，我们暂时不用去修改，后续我们会逐级进行修改）</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/store/questionItem&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuestionItemServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.list(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toAdd&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toAdd(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.save(request, response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.toEdit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.edit(request,response);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>            <span class="hljs-keyword">this</span>.delete(request,response);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//进入列表页</span><br>        <span class="hljs-comment">//获取数据</span><br>        <span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> size = <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>)))&#123;<br>            page = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;page&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>)))&#123;<br>            size = Integer.parseInt(request.getParameter(<span class="hljs-string">&quot;size&quot;</span>));<br>        &#125;<br>        PageInfo all = questionItemService.findAll(page, size);<br>        <span class="hljs-comment">//将数据保存到指定的位置</span><br>        request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/list.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toAdd</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/add.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionItemService.save(questionItem);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/questionItem?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">//查询要修改的数据findById</span><br>        String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>        QuestionItem questionItem = questionItemService.findById(id);<br>        <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>        request.setAttribute(<span class="hljs-string">&quot;questionItem&quot;</span>,questionItem);<br>        <span class="hljs-comment">//跳转页面</span><br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/update.jsp&quot;</span>).forward(request,response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionItemService.update(questionItem);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/questionItem?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>        QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class);<br>        <span class="hljs-comment">//调用业务层接口save</span><br>        questionItemService.delete(questionItem);<br>        <span class="hljs-comment">//跳转回到页面list</span><br>        response.sendRedirect(request.getContextPath()+<span class="hljs-string">&quot;/store/questionItem?operation=list&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doGet(request,response);<br>    &#125;<br></code></pre></div></td></tr></table></figure>

<p>（7）在BaseServlet中添加<code>QuestionItemService</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> CompanyService companyService;<br>    <span class="hljs-keyword">protected</span> DeptService deptService;<br>    <span class="hljs-keyword">protected</span> UserService userService;<br>    <span class="hljs-keyword">protected</span> CourseService courseService;<br>    <span class="hljs-keyword">protected</span> CatalogService catalogService;<br>    <span class="hljs-keyword">protected</span> QuestionService questionService;<br>    <span class="hljs-keyword">protected</span> QuestionItemService questionItemService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        companyService = <span class="hljs-keyword">new</span> CompanyServiceImpl();<br>        deptService = <span class="hljs-keyword">new</span> DeptServiceImpl();<br>        userService = <span class="hljs-keyword">new</span> UserServiceImpl();<br>        courseService = <span class="hljs-keyword">new</span> CourseServiceImpl();<br>        catalogService = <span class="hljs-keyword">new</span> CatalogServiceImpl();<br>        questionService = <span class="hljs-keyword">new</span> QuestionServiceImpl();<br>        questionItemService = <span class="hljs-keyword">new</span> QuestionItemServiceImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（8）创建页面存放的目录<code>/WEB-INF/pages/store/questionItem</code>，从今日课程资料中的<code>模块页面\questionItem</code>下复制所有的页面到刚创建好的目录中</p>
<p>（9）在<code>question</code>模块的<code>list.jsp</code>页面中添加题目选项列表页的入口，因为题目选项是针对某个具体的题目的，在每条列表数据的操作中添加一个配置选项的按钮</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;button type=&quot;button&quot; class=&quot;btn bg-olive btn-xs&quot; onclick=&#x27;location.href=&quot;$&#123;ctx&#125;/store/questionItem?operation=list&amp;questionId=$&#123;o.id&#125;&quot;&#x27;&gt;配置选项&lt;/button&gt;<br></code></pre></div></td></tr></table></figure>

<p>同时在<code>questionItem</code>模块中的<code>list.jsp</code>页面中我们需要删除一些页面元素，分页，新建按钮，删除按钮，只留下刷新按钮</p>
<p>（10）在后台servlet的list方法中接收题目的id，我们要查询的列表应该是该题目下的所有选项列表</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    String questionId = request.getParameter(<span class="hljs-string">&quot;questionId&quot;</span>);<br>    PageInfo all = questionItemService.findAll(questionId,<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br>    <span class="hljs-comment">//将数据保存到指定的位置</span><br>    request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/list.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（11）修改业务层接口方法，添加参数，注意是改带分页的那个方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> questionId 题目对应的id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page 页码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size 每页显示的数据总量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-function">PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(String questionId,<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>（12）在业务层实现类中修改对应的方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> PageInfo <span class="hljs-title">findAll</span><span class="hljs-params">(String questionId,<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>    SqlSession sqlSession = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//1.获取SqlSession</span><br>        sqlSession = MapperFactory.getSqlSession();<br>        <span class="hljs-comment">//2.获取Dao</span><br>        QuestionItemDao questionItemDao = MapperFactory.getMapper(sqlSession,QuestionItemDao.class);<br>        <span class="hljs-comment">//3.调用Dao层操作</span><br>        PageHelper.startPage(page,size);<br>        List&lt;QuestionItem&gt; all = questionItemDao.findAll(questionId);<br>        PageInfo pageInfo = <span class="hljs-keyword">new</span> PageInfo(all);<br>        <span class="hljs-keyword">return</span> pageInfo;<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>        <span class="hljs-comment">//记录日志</span><br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TransactionUtil.close(sqlSession);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（13）修改持久层接口方法<code>findAll</code>，添加查询参数</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据题目id查询所有选项 </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> questionId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-function">List&lt;QuestionItem&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(String questionId)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>（14）修改dao映射配置文件，添加条件</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置查询所有，带条件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span><br>    select<br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>/&gt;</span><br>    from st_question_item<br>    where question_id = #&#123;questionId,jdbcType=VARCHAR&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>（15）对于业务层原有的不带任何参数的<code>findAll</code>方法，我们可以去掉，删除接口和实现类中的无参的<code>findAll</code>方法</p>
<p>（16）启动项目测试效果 </p>
<h3 id="5-2-添加功能制作"><a href="#5-2-添加功能制作" class="headerlink" title="5.2 添加功能制作"></a>5.2 添加功能制作</h3><p>（1）在后台servlet的<code>doGet</code>方法中去掉一些逻辑，<code>toAdd</code>的逻辑判断和对应的<code>toAdd</code>方法需要删除，然后直接查看<code>save</code>方法</p>
<p>（2）<code>save</code>方法最后需要去跳转页面，我们让它直接调用<code>list</code>方法，该方法最后就是跳转页面的</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>    QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    <span class="hljs-comment">//调用业务层接口save</span><br>    questionItemService.save(questionItem);<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（3）找到<code>questionItem</code>模块下的<code>list.jsp</code>页面，在<code>&lt;form id=&quot;editForm&quot;&gt;</code>该表单里面添加一个隐藏域，接收题目的id</p>
<figure class="highlight jsp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;questionId&quot;</span> value=<span class="hljs-string">&quot;$&#123;questionId&#125;&quot;</span>&gt;<br></code></pre></div></td></tr></table></figure>

<p>同时要保证这个值能够在该页面中获取到，我们需要在跳转到该页面的后台<code>list</code>方法中向<code>request</code>域中存入该值即可，修改后台servlet的<code>list</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><br>    String questionId = request.getParameter(<span class="hljs-string">&quot;questionId&quot;</span>);<br>    <span class="hljs-comment">//进入list页时添加对应的问题id，为添加操作使用</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionId&quot;</span>,questionId);<br>    PageInfo all = questionItemService.findAll(questionId,<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br>    <span class="hljs-comment">//将数据保存到指定的位置</span><br>    request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/list.jsp&quot;</span>).forward(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（4）启动项目进行测试</p>
<h3 id="5-3-删除功能制作"><a href="#5-3-删除功能制作" class="headerlink" title="5.3 删除功能制作"></a>5.3 删除功能制作</h3><p>（1）删除首先要解决的是删除完成后端页面跳转问题，需要修改后台servlet的<code>delete</code>方法，删除完成后调用<code>list</code>方法进行跳转</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>    <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>    QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class);<br>    <span class="hljs-comment">//调用业务层接口save</span><br>    questionItemService.delete(questionItem);<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）产生的新的问题是，删除后跳转回<code>list.jsp</code>页面其他的数据都不见了，分析得到的原因是后台servlet执行完成删除调用<code>list</code>方法时，需要去获取题目的id，来查询该题目下的所有选项，这个地方缺少了题目的id，因此解决方案是在页面发送删除请求时需要将题目id传递给后台，因此我们需要去修改页面删除的js代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteById</span>(<span class="hljs-params">id</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> questionId = <span class="hljs-string">&#x27;$&#123;questionId&#125;&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(confirm(<span class="hljs-string">&quot;你确认要删除此条记录吗？&quot;</span>)) &#123;<br>        <span class="hljs-built_in">window</span>.location.href=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/questionItem?operation=delete&amp;questionId=$&#123;questionId&#125;&amp;id=&quot;</span>+id;<br>    &#125;<br>&#125;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>（3）启动项目，进行测试</p>
<h3 id="5-4-修改功能制作"><a href="#5-4-修改功能制作" class="headerlink" title="5.4 修改功能制作"></a>5.4 修改功能制作</h3><p>（1）修改后台servlet的<code>toEdit</code>方法，查询完数据后跳转页面仍然是调用<code>list</code>方法完成跳转</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//查询要修改的数据findById</span><br>    String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>    QuestionItem questionItem = questionItemService.findById(id);<br>    <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionItem&quot;</span>,questionItem);<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（2）出现的问题是，点完编辑后跳转到页面上所有数据都无法显示，包括之前的所有选项数据，我们需要先来解决之前所有的选项数据的显示问题，原因很简单，还是因为在点击编辑的时候没有传递题目的id到后台，后台在通过list方法进行跳转的时候没有题目的id就无法查询题目下的选项</p>
<p>在<code>questionItem/list.jsp</code>页面上修改编辑按钮，添加题目id的参数</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;button type=&quot;button&quot; class=&quot;btn bg-olive btn-xs&quot; onclick=&#x27;location.href=&quot;$&#123;ctx&#125;/store/questionItem?operation=toEdit&amp;questionId=$&#123;questionId&#125;&amp;id=$&#123;o.id&#125;&quot;&#x27;&gt;编辑&lt;/button&gt;<br></code></pre></div></td></tr></table></figure>

<p>（3）然后在解决点完编辑后对应编辑的数据无法展示的问题，需要调整<code>questionItem/list.jsp</code>页面表单，添加数据的展示</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form id=<span class="hljs-string">&quot;editForm&quot;</span> action=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/questionItem?operation=saveOrUpdate&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;questionId&quot;</span> value=<span class="hljs-string">&quot;$&#123;questionId&#125;&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;id&quot;</span> value=<span class="hljs-string">&quot;$&#123;questionItem.id&#125;&quot;</span>&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;row data-type&quot;</span> style=<span class="hljs-string">&quot;margin: 0px&quot;</span>&gt;<br><br>        &lt;div class=&quot;col-md-2 title&quot;&gt;选项内容&lt;/div&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-4 data&quot;</span>&gt;<br>            &lt;input type=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> placeholder=<span class="hljs-string">&quot;选项内容&quot;</span> name=<span class="hljs-string">&quot;content&quot;</span> value=<span class="hljs-string">&quot;$&#123;questionItem.content&#125;&quot;</span>&gt;<br>        &lt;/div&gt;<br><br>        &lt;div class=&quot;col-md-2 title&quot;&gt;选项图片&lt;/div&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-4 data&quot;</span>&gt;<br>            &lt;input type=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> placeholder=<span class="hljs-string">&quot;请选择&quot;</span> name=<span class="hljs-string">&quot;picture&quot;</span> &gt;<br>        &lt;/div&gt;<br><br>        &lt;%--&lt;div class=&quot;col-md-2 title&quot;&gt;是否正确答案&lt;/div&gt;<br>                    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-4 data&quot;</span>&gt;<br>                        &lt;select <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> name=<span class="hljs-string">&quot;isRight&quot;</span>&gt;<br>                            &lt;option value=&quot;&quot;&gt;请选择&lt;/option&gt;<br>                            &lt;option value=&quot;1&quot;&gt;正确答案&lt;/option&gt;<br>                            &lt;option value=&quot;0&quot;&gt;错误选项&lt;/option&gt;<br>                        &lt;/select&gt;<br>                    &lt;/div&gt;--%&gt;<br>        &lt;div class=&quot;col-md-2 title&quot;&gt;是否正确答案&lt;/div&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-md-4 data&quot;</span>&gt;<br>            &lt;select <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;form-control&quot;</span> name=<span class="hljs-string">&quot;isRight&quot;</span>&gt;<br>                &lt;option value=&quot;&quot;&gt;请选择&lt;/option&gt;<br>                &lt;option value=&quot;1&quot; $&#123;questionItem.isRight eq &quot;1&quot; ? &quot;selected&quot; : &quot;&quot;&#125;&gt;正确答案&lt;/option&gt;<br>                &lt;option value=&quot;0&quot; $&#123;questionItem.isRight eq &quot;0&quot; ? &quot;selected&quot; : &quot;&quot;&#125;&gt;错误选项&lt;/option&gt;<br>            &lt;/select&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/form&gt;<br></code></pre></div></td></tr></table></figure>

<p>（4）启动后测试，发现了新的问题，我们要提交编辑的数据，但结果却变成了保存，问题的原因是什么呢？</p>
<p>经过分析发现是因为表单的提交路径一直写的就是保存的路径，如何解决呢？</p>
<p>通过后台传递一个操作类型的变量值到前端，前端在表单的<code>action</code>里面使用该变量值，通过这个变量我们来控制是新增还是编辑</p>
<p>在后台的<code>list</code>和<code>toEdit</code>方法中来操作该变量值</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list2</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    String questionId = request.getParameter(<span class="hljs-string">&quot;questionId&quot;</span>);<br>    <span class="hljs-comment">//进入list页时添加对应的问题id，为添加操作使用</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionId&quot;</span>,questionId);<br>    <span class="hljs-comment">//获取数据</span><br>    PageInfo all = questionItemService.findAll(questionId, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br>    <span class="hljs-comment">//将数据保存到指定的位置</span><br>    request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br><br>    <span class="hljs-keyword">if</span>(request.getAttribute(<span class="hljs-string">&quot;operation&quot;</span>) == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">//保存一个操作的类型，传递到前端save</span><br>        request.setAttribute(<span class="hljs-string">&quot;operation&quot;</span>, <span class="hljs-string">&quot;save&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/list.jsp&quot;</span>).forward(request,response);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//查询要修改的数据findById</span><br>    String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>    QuestionItem questionItem = questionItemService.findById(id);<br>    <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionItem&quot;</span>,questionItem);<br><br>    <span class="hljs-comment">//保存一个操作的类型，传递到前端save</span><br>    request.setAttribute(<span class="hljs-string">&quot;operation&quot;</span>,<span class="hljs-string">&quot;edit&quot;</span>);<br><br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>然后需要在页面的表单<code>action</code>属性上接收该值</p>
<figure class="highlight jsp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form id=<span class="hljs-string">&quot;editForm&quot;</span> action=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/questionItem?operation=$&#123;operation&#125;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br></code></pre></div></td></tr></table></figure>

<p>（5）启动项目进行测试</p>
<p>（6）测试发现编辑后，提交编辑的数据完成编辑哦呼跳转回页面，页面所有的数据又消失了，回到后台servlet查看<code>edit</code>方法，发现是页面跳转的问题</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">edit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>    <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>    QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    <span class="hljs-comment">//调用业务层接口save</span><br>    questionItemService.update(questionItem);<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（7）数据显示的问题解决后我们发现数据并没有真正的修改完成，分析原因发现是因为编辑后提交编辑的数据进行修改，但是没有提交问题选项的id值，我们需要在表单中接收问题选项的id值，能够让它在编辑的时候被提交到后台</p>
<figure class="highlight jsp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;id&quot;</span> value=<span class="hljs-string">&quot;$&#123;questionItem.id&#125;&quot;</span>&gt;<br></code></pre></div></td></tr></table></figure>

<p>（8）启动项目进行测试</p>
<h3 id="5-5-添加修改功能合并"><a href="#5-5-添加修改功能合并" class="headerlink" title="5.5 添加修改功能合并"></a>5.5 添加修改功能合并</h3><p>（1）把<code>questionItem/list.jsp</code>进行备份，<code>questionItem/list2.jsp</code></p>
<p>（2）将后台<code>list,toEdit</code>方法进行备份，分别叫做<code>list2,toEdit2</code>，与前台的<code>list2.jsp</code>配套，</p>
<p>（3）在后台servlet中封装一个<code>saveOrUpdate</code>方法，同时需要修改<code>doGet</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    String operation = request.getParameter(<span class="hljs-string">&quot;operation&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;list&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.list(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;save&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.save(request, response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;toEdit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.toEdit(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;edit&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.edit(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;delete&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.delete(request,response);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;saveOrUpdate&quot;</span>.equals(operation))&#123;<br>        <span class="hljs-keyword">this</span>.saveOrUpdate(request,response);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveOrUpdate</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//将数据获取到，封装成一个对象</span><br>    QuestionItem questionItem = BeanUtil.fillBean(request,QuestionItem.class,<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    <span class="hljs-comment">//如果页面传递了当前数据的id，则为修改业务，否则为添加业务</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(questionItem.getId()))&#123;<br>        questionItemService.update(questionItem);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        questionItemService.save(questionItem);<br>    &#125;<br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（4）修改原始的<code>list,toEdit</code>方法，不需要之前添加操作标识的变量了</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    String questionId = request.getParameter(<span class="hljs-string">&quot;questionId&quot;</span>);<br>    <span class="hljs-comment">//进入list页时添加对应的问题id，为添加操作使用</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionId&quot;</span>,questionId);<br>    <span class="hljs-comment">//获取数据</span><br>    PageInfo all = questionItemService.findAll(questionId, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br>    <span class="hljs-comment">//将数据保存到指定的位置</span><br>    request.setAttribute(<span class="hljs-string">&quot;page&quot;</span>,all);<br><br>    <span class="hljs-comment">//跳转页面</span><br>    request.getRequestDispatcher(<span class="hljs-string">&quot;/WEB-INF/pages/store/questionItem/list.jsp&quot;</span>).forward(request,response);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toEdit</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <span class="hljs-comment">//查询要修改的数据findById</span><br>    String id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br>    QuestionItem questionItem = questionItemService.findById(id);<br>    <span class="hljs-comment">//将数据加载到指定区域，供页面获取</span><br>    request.setAttribute(<span class="hljs-string">&quot;questionItem&quot;</span>,questionItem);<br><br>    <span class="hljs-comment">//跳转回到页面list</span><br>    list(request,response);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>（5）修改<code>list.jsp</code>页面表单的<code>action</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;form id=<span class="hljs-string">&quot;editForm&quot;</span> action=<span class="hljs-string">&quot;$&#123;ctx&#125;/store/questionItem?operation=saveOrUpdate&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br></code></pre></div></td></tr></table></figure>

<p>（6）启动项目测试</p>
<h3 id="5-6-删除功能相关问题及解决方案"><a href="#5-6-删除功能相关问题及解决方案" class="headerlink" title="5.6 删除功能相关问题及解决方案"></a>5.6 删除功能相关问题及解决方案</h3><p>题目选项功能完成后，伴随而来的是题目的有些功能出现了问题，比如：删除题目，题目数据删除了，那该题目下的选项数据呢？目前是没有删除，</p>
<p>因此我们要解决的是：删除题目数据的时候伴随着删除该题目下的选项数据</p>
<p><strong>解决方案</strong></p>
<p><strong>解决方案一:触发器</strong></p>
<p>◆注意使用触发器实现是将业务绑定到了数据库端,在进行系统设计时要确认方案</p>
<p><strong>解决方案二:业务层删除操作中分别调用两个模块的删除功能</strong></p>
<p>◆注意删除主使用按id删除,删除从使用按关联id删除</p>
<p>◆注意删除的顺序,先删从,后删主</p>
<p><strong>解决方案三:存储过程</strong></p>
<p>◆整套的数据层解决方案,没有单一功能使用的</p>
<p><strong>解决方案四:依赖框架提供的级联删除功能</strong></p>
<p><strong>解决方案五:定时维护/垃圾数据清理</strong></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/WEB%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/">WEB综合案例</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/WEB%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/">WEB综合案例</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B03/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JavaWeb综合案例03</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/27/JavaWeb%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B01/">
                        <span class="hidden-mobile">JavaWeb综合案例01</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.lazyComments('valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#valine",
          app_id: "7FicXKczRMSUD3slGCpiLLto-gzGzoHsz",
          app_key: "L7N1wkygdm2UHsrq5DHTuMMk",
          placeholder: "说点什么",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: true,
          serverURLs: "https://7ficxkcz.lc-cn-n1-shared.com",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a target="_blank" href="https://www.12377.cn/" rel="nofollow noopener noopener">中央网信办（国家互联网信息办公室）违法和不良信息举报中心</a>

  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        京ICP证123456号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
            
            <span>京公网安备12345678号</span>
          </a>
        </span>
      
    
  </div>


  
  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  








  

  

  

  

  
    <!-- 51.la Analytics -->
    <script defer type="text/javascript" src="//js.users.51.la/21111747.js"></script>
  

  




  
<script src="/js/caidai.js"></script>
<script src="/js/dianjichuzi.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>

  <script type="text/javascript" src="//js.users.51.la/21111747.js"></script>
</body>
</html>
