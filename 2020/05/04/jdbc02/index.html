

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="nitto">
  <meta name="keywords" content="">
  
  <title>JDBC-02 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/toubudaziji.css">
<link rel="stylesheet" href="/css/gundongtiao.css">
<link rel="stylesheet" href="/css/shubiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zfqwb.github.io","root":"/","version":"1.8.9","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":21111747,"cnzz":null,"leancloud":{"app_id":"bMWk1sw4iFwEPTeRxqFOkxvq-gzGzoHsz","app_key":"sDMo4aGFa1dFrXYs2oXkNaVY","server_url":"https://bmwk1sw4.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  <meta name="baidu-site-verification" content="code-vbtyv0liY1" />
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>nitto</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="JDBC-02">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-05-04 19:19" pubdate>
        2020年5月4日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      133
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JDBC-02</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2 个月前
                
              </p>
            
            <div class="markdown-body">
              <h3 id="一、数据库连接池"><a href="#一、数据库连接池" class="headerlink" title="一、数据库连接池"></a>一、数据库连接池</h3><h4 id="1-数据库连接池的概念"><a href="#1-数据库连接池的概念" class="headerlink" title="1. 数据库连接池的概念"></a>1. 数据库连接池的概念</h4><ul>
<li>数据库连接背景<ul>
<li>数据库连接是一种关键的、有限的、昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出</li>
<li>对数据库连接的管理能显著影响到整个应用程序的伸缩性和健壮性，影响到程序的性能指标</li>
<li>数据库连接池正是针对这个问题提出来的</li>
</ul>
</li>
<li>数据库连接池<ul>
<li>数据库连接池负责分配、管理和释放数据库连接</li>
<li>它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个</li>
<li>这项技术能明显提高对数据库操作的性能</li>
</ul>
</li>
<li>数据库连接池原理</li>
</ul>
<p><img src="/2020/05/04/jdbc02/JDBC-02-%E6%8E%88%E8%AF%BE%E7%AC%94%E8%AE%B0.assets/01.png" srcset="/img/loading.gif" lazyload alt="01"></p>
<h4 id="2-自定义连接池"><a href="#2-自定义连接池" class="headerlink" title="2. 自定义连接池"></a>2. 自定义连接池</h4><ul>
<li>java.sql.DataSource接口：数据源(数据库连接池)。<strong>java官方提供的数据库连接池规范(接口)</strong></li>
<li>如果想完成数据库连接池技术，就必须实现 <strong>DataSource</strong> 接口</li>
<li>核心功能：获取数据库连接对象：<strong>Connection getConnection();</strong></li>
<li>自定义连接池：<ol>
<li>定义一个类，实现 DataSource 接口。</li>
<li> 定义一个容器，用于保存多个 Connection 连接对象。</li>
<li> 定义静态代码块，通过 JDBC 工具类获取 10 个连接保存到容器中。</li>
<li> 重写 getConnection 方法，从容器中获取一个连接并返回。</li>
<li> 定义 getSize 方法，用于获取容器的大小并返回。</li>
</ol>
</li>
<li>具体实现：<ul>
<li>新建java项目jdbc高级，新建libs目录，添加mysql驱动jar包，并且添加引用库</li>
<li>将上个项目的config.properties复制到src中</li>
<li>将上个项目的JDBCUtils复制到com.itheima.utils中</li>
<li>新建数据库连接池类： com.itheima01.MyDataSource，代码如下：</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima01;<br><br><span class="hljs-keyword">import</span> com.itheima.utils.JDBCUtils;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.sql.SQLFeatureNotSupportedException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.logging.Logger;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	自定义连接池类</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DataSource</span></span>&#123;<br>    <span class="hljs-comment">//定义集合容器，用于保存多个数据库连接对象 （创建的是一个线程安全的ArrayList）</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Connection&gt; pool = Collections.synchronizedList(<span class="hljs-keyword">new</span> ArrayList&lt;Connection&gt;());<br><br>    <span class="hljs-comment">//静态代码块，生成10个数据库连接保存到集合中</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            Connection con = JDBCUtils.getConnection();<br>            pool.add(con);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//返回连接池的大小</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pool.size();<br>    &#125;<br><br>    <span class="hljs-comment">//从池中返回一个数据库连接</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(pool.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//从池中获取数据库连接</span><br>            <span class="hljs-keyword">return</span> pool.remove(<span class="hljs-number">0</span>); <span class="hljs-comment">//注意：从集合中移除一个，并返回（我们每次都是从集合中拿走一个去用，所以是remove，这个方法正好是能够返回移除的这个对象）</span><br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;连接数量已用尽&quot;</span>);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//剩下的其他方法，我们先不用具体处理</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">(String username, String password)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">unwrap</span><span class="hljs-params">(Class&lt;T&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWrapperFor</span><span class="hljs-params">(Class&lt;?&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PrintWriter <span class="hljs-title">getLogWriter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLogWriter</span><span class="hljs-params">(PrintWriter out)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLoginTimeout</span><span class="hljs-params">(<span class="hljs-keyword">int</span> seconds)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getLoginTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Logger <span class="hljs-title">getParentLogger</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLFeatureNotSupportedException </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h4 id="3-自定义连接池测试"><a href="#3-自定义连接池测试" class="headerlink" title="3. 自定义连接池测试"></a>3. 自定义连接池测试</h4><ul>
<li>测试：通过自定义数据库连接池完成查询学生表的全部信息</li>
<li>具体代码：新建com.itheima01.MyDataSourceTest </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima01;<br><br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSourceTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//创建数据库连接池对象</span><br>        MyDataSource dataSource = <span class="hljs-keyword">new</span> MyDataSource();<br><br>        System.out.println(<span class="hljs-string">&quot;使用之前连接池数量：&quot;</span> + dataSource.getSize());<br>        <br>        <span class="hljs-comment">//获取数据库连接对象</span><br>        Connection con = dataSource.getConnection();<br>        System.out.println(con.getClass());<span class="hljs-comment">// JDBC4Connection</span><br><br>        <span class="hljs-comment">//查询学生表全部信息</span><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student&quot;</span>;<br>        PreparedStatement pst = con.prepareStatement(sql);<br>        ResultSet rs = pst.executeQuery();<br><br>        <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>            System.out.println(rs.getInt(<span class="hljs-string">&quot;sid&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getString(<span class="hljs-string">&quot;name&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getInt(<span class="hljs-string">&quot;age&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getDate(<span class="hljs-string">&quot;birthday&quot;</span>));<br>        &#125;<br>        <br>        <span class="hljs-comment">//释放资源</span><br>        rs.close();<br>        pst.close();<br>		<span class="hljs-comment">//目前的连接对象close方法，是直接关闭连接，而不是将连接归还池中</span><br>        con.close();<br><br>        System.out.println(<span class="hljs-string">&quot;使用之后连接池数量：&quot;</span> + dataSource.getSize());<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h4 id="4-归还连接"><a href="#4-归还连接" class="headerlink" title="4. 归还连接"></a>4. 归还连接</h4><ul>
<li>归还方式：<ol>
<li>继承方式</li>
<li>装饰设计模式</li>
<li>适配器设计模式</li>
<li>动态代理方式</li>
</ol>
</li>
</ul>
<h5 id="4-1-继承-无法解决"><a href="#4-1-继承-无法解决" class="headerlink" title="4.1  继承(无法解决)"></a>4.1  继承(无法解决)</h5><ol>
<li>继承方式归还数据库连接的思想</li>
</ol>
<ul>
<li>通过打印连接对象，发现 DriverManager 获取的连接实现类是 JDBC4Connection</li>
<li>那我们就可以自定义一个类，继承 JDBC4Connection 这个类，重写 close() 方法，完成连接对象的归还</li>
</ul>
<ol start="2">
<li><p>继承方式归还数据库连接的实现步骤</p>
<ol>
<li>定义一个类，继承 JDBC4Connection </li>
<li> 定义 Connection 连接对象和连接池容器对象的成员变量</li>
<li> 通过有参构造方法完成对成员变量的赋值</li>
<li> 重写 close 方法，将连接对象添加到池中</li>
</ol>
</li>
<li><p>继承方式归还数据库连接存在的问题</p>
</li>
</ol>
<ul>
<li>通过查看 JDBC 工具类获取连接的方法发现：我们虽然自定义了一个子类，完成了归还连接的操作。</li>
<li>但是 DriverManager 获取的还是 JDBC4Connection 这个对象，并不是我们的子类对象，</li>
<li>而我们又不能整体去修改驱动包中类的功能，所继承这种方式行不通！</li>
</ul>
<ol start="4">
<li>来，我们测试一下：自定义一个类，继承JDBC4Connection这个类，重写close()方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    自定义Connection类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConnection1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JDBC4Connection</span> </span>&#123;<br>    <span class="hljs-comment">//声明连接对象和连接池集合对象</span><br>    <span class="hljs-keyword">private</span> Connection con;<br>    <span class="hljs-keyword">private</span> List&lt;Connection&gt; pool;<br><br>    <span class="hljs-comment">//通过构造方法给成员变量赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyConnection1</span><span class="hljs-params">(String hostToConnectTo, <span class="hljs-keyword">int</span> portToConnectTo, Properties info, String databaseToConnectTo, String url,Connection con,List&lt;Connection&gt; pool)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">super</span>(hostToConnectTo, portToConnectTo, info, databaseToConnectTo, url);<br>        <span class="hljs-keyword">this</span>.con = con;<br>        <span class="hljs-keyword">this</span>.pool = pool;<br>    &#125;<br><br>    <span class="hljs-comment">//重写close()方法，将连接归还给池中</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        pool.add(con);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>但是这种方式行不通，通过查看JDBC工具类获取连接的方法我们发现：我们虽然自定义了一个子类，完成了归还连接的操作。但是DriverManager获取的还是JDBC4Connection这个对象，并不是我们的子类对象。而我们又不能整体去修改驱动包中类的功能！</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//将之前的连接对象换成自定义的子类对象</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MyConnection1 con;<br><br><span class="hljs-comment">//4.获取数据库连接的方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//等效于：MyConnection1 con = new JDBC4Connection();  语法错误！</span><br>        con = DriverManager.getConnection(url,username,password);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> con;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h5 id="4-2-装饰设计模式"><a href="#4-2-装饰设计模式" class="headerlink" title="4.2 装饰设计模式"></a>4.2 装饰设计模式</h5><ol>
<li>装饰设计模式归还数据库连接的思想</li>
</ol>
<ul>
<li>我们可以自定义一个类，实现 Connection 接口。这样就具备了和 JDBC4Connection 相同的行为了</li>
<li>重写 close() 方法，完成连接的归还。其余的功能还调用 mysql 驱动包实现类原有的方法即可</li>
</ul>
<ol start="2">
<li>装饰设计模式归还数据库连接的实现步骤<ol>
<li>定义一个类，实现 Connection 接口</li>
<li> 定义 Connection 连接对象和连接池容器对象的成员变量</li>
<li> 通过有参构造方法完成对成员变量的赋值</li>
<li> 重写 close() 方法，将连接对象添加到池中</li>
<li> 剩余方法，只需要调用 mysql 驱动包的连接对象完成即可</li>
<li> 在自定义连接池中，将获取的连接对象通过自定义连接对象进行包装</li>
</ol>
</li>
<li>装饰设计模式归还数据库连接存在的问题。<ul>
<li>实现 Connection 接口后，有大量的方法需要在自定义类中进行重写</li>
</ul>
</li>
<li>实现：自定义连接类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    自定义Connection类。通过装饰设计模式，实现和mysql驱动包中的Connection实现类相同的功能！</span><br><span class="hljs-comment">    实现步骤：</span><br><span class="hljs-comment">        1.定义一个类，实现Connection接口</span><br><span class="hljs-comment">        2.定义Connection连接对象和连接池容器对象的变量</span><br><span class="hljs-comment">        3.提供有参构造方法，接收连接对象和连接池对象，对变量赋值</span><br><span class="hljs-comment">        4.在close()方法中，完成连接的归还</span><br><span class="hljs-comment">        5.剩余方法，只需要调用mysql驱动包的连接对象完成即可</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConnection2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Connection</span> </span>&#123;<br><br>    <span class="hljs-comment">//2.定义Connection连接对象和连接池容器对象的变量</span><br>    <span class="hljs-keyword">private</span> Connection con;<br>    <span class="hljs-keyword">private</span> List&lt;Connection&gt; pool;<br><br>    <span class="hljs-comment">//3.提供有参构造方法，接收连接对象和连接池对象，对变量赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyConnection2</span><span class="hljs-params">(Connection con,List&lt;Connection&gt; pool)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.con = con;<br>        <span class="hljs-keyword">this</span>.pool = pool;<br>    &#125;<br><br>    <span class="hljs-comment">//4.在close()方法中，完成连接的归还</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        pool.add(con);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">nativeSQL</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.nativeSQL(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAutoCommit</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> autoCommit)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setAutoCommit(autoCommit);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">getAutoCommit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getAutoCommit();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.commit();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rollback</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.rollback();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isClosed</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isClosed();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DatabaseMetaData <span class="hljs-title">getMetaData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getMetaData();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setReadOnly</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> readOnly)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setReadOnly(readOnly);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isReadOnly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isReadOnly();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCatalog</span><span class="hljs-params">(String catalog)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setCatalog(catalog);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCatalog</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getCatalog();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTransactionIsolation</span><span class="hljs-params">(<span class="hljs-keyword">int</span> level)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setTransactionIsolation(level);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTransactionIsolation</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getTransactionIsolation();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SQLWarning <span class="hljs-title">getWarnings</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getWarnings();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearWarnings</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.clearWarnings();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement(resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql,resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Class&lt;?&gt;&gt; getTypeMap() <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> con.getTypeMap();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTypeMap</span><span class="hljs-params">(Map&lt;String, Class&lt;?&gt;&gt; map)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setTypeMap(map);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHoldability</span><span class="hljs-params">(<span class="hljs-keyword">int</span> holdability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setHoldability(holdability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHoldability</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getHoldability();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Savepoint <span class="hljs-title">setSavepoint</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.setSavepoint();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Savepoint <span class="hljs-title">setSavepoint</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.setSavepoint(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rollback</span><span class="hljs-params">(Savepoint savepoint)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.rollback(savepoint);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">releaseSavepoint</span><span class="hljs-params">(Savepoint savepoint)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.releaseSavepoint(savepoint);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement(resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql,resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> autoGeneratedKeys)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,autoGeneratedKeys);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span>[] columnIndexes)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,columnIndexes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, String[] columnNames)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,columnNames);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Clob <span class="hljs-title">createClob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createClob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Blob <span class="hljs-title">createBlob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createBlob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> NClob <span class="hljs-title">createNClob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createNClob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SQLXML <span class="hljs-title">createSQLXML</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createSQLXML();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isValid</span><span class="hljs-params">(<span class="hljs-keyword">int</span> timeout)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isValid(timeout);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setClientInfo</span><span class="hljs-params">(String name, String value)</span> <span class="hljs-keyword">throws</span> SQLClientInfoException </span>&#123;<br>        con.setClientInfo(name,value);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setClientInfo</span><span class="hljs-params">(Properties properties)</span> <span class="hljs-keyword">throws</span> SQLClientInfoException </span>&#123;<br>        con.setClientInfo(properties);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getClientInfo</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getClientInfo(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Properties <span class="hljs-title">getClientInfo</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getClientInfo();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Array <span class="hljs-title">createArrayOf</span><span class="hljs-params">(String typeName, Object[] elements)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createArrayOf(typeName,elements);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Struct <span class="hljs-title">createStruct</span><span class="hljs-params">(String typeName, Object[] attributes)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStruct(typeName,attributes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSchema</span><span class="hljs-params">(String schema)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setSchema(schema);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSchema</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getSchema();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">abort</span><span class="hljs-params">(Executor executor)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.abort(executor);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setNetworkTimeout</span><span class="hljs-params">(Executor executor, <span class="hljs-keyword">int</span> milliseconds)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setNetworkTimeout(executor,milliseconds);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getNetworkTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getNetworkTimeout();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">unwrap</span><span class="hljs-params">(Class&lt;T&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.unwrap(iface);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWrapperFor</span><span class="hljs-params">(Class&lt;?&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isWrapperFor(iface);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li> 自定义连接池类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DataSource</span></span>&#123;<br>    <span class="hljs-comment">//定义集合容器，用于保存多个数据库连接对象</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Connection&gt; pool = Collections.synchronizedList(<span class="hljs-keyword">new</span> ArrayList&lt;Connection&gt;());<br><br>    <span class="hljs-comment">//静态代码块，生成10个数据库连接保存到集合中</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            Connection con = JDBCUtils.getConnection();<br>            pool.add(con);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//返回连接池的大小</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pool.size();<br>    &#125;<br><br>    <span class="hljs-comment">//从池中返回一个数据库连接</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(pool.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//从池中获取数据库连接</span><br>            Connection con = pool.remove(<span class="hljs-number">0</span>);<br>            <span class="hljs-comment">//通过自定义连接对象进行包装</span><br>            MyConnection2 mycon = <span class="hljs-keyword">new</span> MyConnection2(con,pool);<br>            <span class="hljs-comment">//返回包装后的连接对象</span><br>            <span class="hljs-keyword">return</span> mycon;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;连接数量已用尽&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h5 id="4-3-适配器设计模式"><a href="#4-3-适配器设计模式" class="headerlink" title="4.3 适配器设计模式"></a>4.3 适配器设计模式</h5><ol>
<li>适配器设计模式归还数据库连接的思想。</li>
</ol>
<ul>
<li>我们可以提供一个适配器类，实现 Connection 接口，将所有方法进行实现(除了close方法)</li>
<li>自定义连接类只需要继承这个适配器类，重写需要改进的 close() 方法即可</li>
</ul>
<ol start="2">
<li><p>适配器设计模式归还数据库连接的实现步骤。</p>
<ol>
<li>定义一个适配器类，实现 Connection 接口</li>
<li> 定义 Connection 连接对象的成员变量</li>
<li> 通过有参构造方法完成对成员变量的赋值</li>
<li> 重写所有方法(除了 close )，调用mysql驱动包的连接对象完成即可</li>
<li> 定义一个连接类，继承适配器类</li>
<li> 定义 Connection 连接对象和连接池容器对象的成员变量，并通过有参构造进行赋值。</li>
<li> 重写 close() 方法，完成归还连接</li>
<li> 在自定义连接池中，将获取的连接对象通过自定义连接对象进行包装</li>
</ol>
</li>
<li><p>适配器设计模式归还数据库连接存在的问题</p>
<ul>
<li>自定义连接类虽然很简洁了，但适配器类还是我们自己编写的，也比较的麻烦</li>
</ul>
</li>
</ol>
<ol start="4">
<li>适配器类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    适配器抽象类。实现Connection接口。</span><br><span class="hljs-comment">    实现所有的方法，调用mysql驱动包中Connection连接对象的方法</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Connection</span> </span>&#123;<br><br>    <span class="hljs-comment">// 定义数据库连接对象的变量</span><br>    <span class="hljs-keyword">private</span> Connection con;<br><br>    <span class="hljs-comment">// 通过构造方法赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyAdapter</span><span class="hljs-params">(Connection con)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.con = con;<br>    &#125;<br><br>    <span class="hljs-comment">// 所有的方法，均调用mysql的连接对象实现</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">nativeSQL</span><span class="hljs-params">(String sql)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.nativeSQL(sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAutoCommit</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> autoCommit)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setAutoCommit(autoCommit);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">getAutoCommit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getAutoCommit();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.commit();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rollback</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.rollback();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isClosed</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isClosed();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DatabaseMetaData <span class="hljs-title">getMetaData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getMetaData();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setReadOnly</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> readOnly)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setReadOnly(readOnly);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isReadOnly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isReadOnly();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCatalog</span><span class="hljs-params">(String catalog)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setCatalog(catalog);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCatalog</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getCatalog();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTransactionIsolation</span><span class="hljs-params">(<span class="hljs-keyword">int</span> level)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setTransactionIsolation(level);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTransactionIsolation</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getTransactionIsolation();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SQLWarning <span class="hljs-title">getWarnings</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getWarnings();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearWarnings</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.clearWarnings();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement(resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql,resultSetType,resultSetConcurrency);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Class&lt;?&gt;&gt; getTypeMap() <span class="hljs-keyword">throws</span> SQLException &#123;<br>        <span class="hljs-keyword">return</span> con.getTypeMap();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTypeMap</span><span class="hljs-params">(Map&lt;String, Class&lt;?&gt;&gt; map)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setTypeMap(map);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHoldability</span><span class="hljs-params">(<span class="hljs-keyword">int</span> holdability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setHoldability(holdability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHoldability</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getHoldability();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Savepoint <span class="hljs-title">setSavepoint</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.setSavepoint();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Savepoint <span class="hljs-title">setSavepoint</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.setSavepoint(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rollback</span><span class="hljs-params">(Savepoint savepoint)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.rollback(savepoint);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">releaseSavepoint</span><span class="hljs-params">(Savepoint savepoint)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.releaseSavepoint(savepoint);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">createStatement</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStatement(resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CallableStatement <span class="hljs-title">prepareCall</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> resultSetType, <span class="hljs-keyword">int</span> resultSetConcurrency, <span class="hljs-keyword">int</span> resultSetHoldability)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareCall(sql,resultSetType,resultSetConcurrency,resultSetHoldability);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span> autoGeneratedKeys)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,autoGeneratedKeys);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, <span class="hljs-keyword">int</span>[] columnIndexes)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,columnIndexes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">prepareStatement</span><span class="hljs-params">(String sql, String[] columnNames)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.prepareStatement(sql,columnNames);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Clob <span class="hljs-title">createClob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createClob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Blob <span class="hljs-title">createBlob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createBlob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> NClob <span class="hljs-title">createNClob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createNClob();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SQLXML <span class="hljs-title">createSQLXML</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createSQLXML();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isValid</span><span class="hljs-params">(<span class="hljs-keyword">int</span> timeout)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isValid(timeout);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setClientInfo</span><span class="hljs-params">(String name, String value)</span> <span class="hljs-keyword">throws</span> SQLClientInfoException </span>&#123;<br>        con.setClientInfo(name,value);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setClientInfo</span><span class="hljs-params">(Properties properties)</span> <span class="hljs-keyword">throws</span> SQLClientInfoException </span>&#123;<br>        con.setClientInfo(properties);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getClientInfo</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getClientInfo(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Properties <span class="hljs-title">getClientInfo</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getClientInfo();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Array <span class="hljs-title">createArrayOf</span><span class="hljs-params">(String typeName, Object[] elements)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createArrayOf(typeName,elements);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Struct <span class="hljs-title">createStruct</span><span class="hljs-params">(String typeName, Object[] attributes)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.createStruct(typeName,attributes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSchema</span><span class="hljs-params">(String schema)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setSchema(schema);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSchema</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getSchema();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">abort</span><span class="hljs-params">(Executor executor)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.abort(executor);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setNetworkTimeout</span><span class="hljs-params">(Executor executor, <span class="hljs-keyword">int</span> milliseconds)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        con.setNetworkTimeout(executor,milliseconds);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getNetworkTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.getNetworkTimeout();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">unwrap</span><span class="hljs-params">(Class&lt;T&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.unwrap(iface);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWrapperFor</span><span class="hljs-params">(Class&lt;?&gt; iface)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> con.isWrapperFor(iface);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>自定义连接类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    自定义Connection连接类。通过适配器设计模式。完成close()方法的重写</span><br><span class="hljs-comment">        1.定义一个类，继承适配器父类</span><br><span class="hljs-comment">        2.定义Connection连接对象和连接池容器对象的变量</span><br><span class="hljs-comment">        3.提供有参构造方法，接收连接对象和连接池对象，对变量赋值</span><br><span class="hljs-comment">        4.在close()方法中，完成连接的归还</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConnection3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyAdapter</span> </span>&#123;<br>    <span class="hljs-comment">//2.定义Connection连接对象和连接池容器对象的变量</span><br>    <span class="hljs-keyword">private</span> Connection con;<br>    <span class="hljs-keyword">private</span> List&lt;Connection&gt; pool;<br><br>    <span class="hljs-comment">//3.提供有参构造方法，接收连接对象和连接池对象，对变量赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyConnection3</span><span class="hljs-params">(Connection con,List&lt;Connection&gt; pool)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(con);    <span class="hljs-comment">// 将接收的数据库连接对象给适配器父类传递</span><br>        <span class="hljs-keyword">this</span>.con = con;<br>        <span class="hljs-keyword">this</span>.pool = pool;<br>    &#125;<br><br>    <span class="hljs-comment">//4.在close()方法中，完成连接的归还</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        pool.add(con);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>自定义连接池类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DataSource</span></span>&#123;<br>    <span class="hljs-comment">//定义集合容器，用于保存多个数据库连接对象</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Connection&gt; pool = Collections.synchronizedList(<span class="hljs-keyword">new</span> ArrayList&lt;Connection&gt;());<br><br>    <span class="hljs-comment">//静态代码块，生成10个数据库连接保存到集合中</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            Connection con = JDBCUtils.getConnection();<br>            pool.add(con);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//返回连接池的大小</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pool.size();<br>    &#125;<br><br>    <span class="hljs-comment">//从池中返回一个数据库连接</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(pool.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//从池中获取数据库连接</span><br>            Connection con = pool.remove(<span class="hljs-number">0</span>);<br><br>            <span class="hljs-comment">//通过自定义连接对象进行包装</span><br>            <span class="hljs-comment">//MyConnection2 mycon = new MyConnection2(con,pool);</span><br>            MyConnection3 mycon = <span class="hljs-keyword">new</span> MyConnection3(con,pool);<br><br>            <span class="hljs-comment">//返回包装后的连接对象</span><br>            <span class="hljs-keyword">return</span> mycon;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;连接数量已用尽&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<h5 id="4-4-动态代理"><a href="#4-4-动态代理" class="headerlink" title="4.4 动态代理"></a>4.4 动态代理</h5><ul>
<li><p>经过我们适配器模式的改进，自定义连接类中的方法已经很简洁了。剩余所有的方法已经抽取到了适配器类中。</p>
</li>
<li><p>但是适配器这个类还是我们自己编写的，也比较麻烦！所以可以使用动态代理的方式来改进。</p>
</li>
<li><p>动态代理：在不改变目标对象方法的情况下对方法进行增强</p>
</li>
<li><p>组成</p>
<ul>
<li>被代理对象：真实的对象</li>
<li> 代理对象：内存中的一个对象</li>
</ul>
</li>
<li><p>要求</p>
<ul>
<li> 代理对象必须和被代理对象实现相同的接口</li>
</ul>
</li>
<li><p>实现</p>
<ul>
<li>Proxy.newProxyInstance()</li>
</ul>
</li>
<li><p>自定义数据库连接池类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DataSource</span></span>&#123;<br>    <span class="hljs-comment">//定义集合容器，用于保存多个数据库连接对象</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Connection&gt; pool = Collections.synchronizedList(<span class="hljs-keyword">new</span> ArrayList&lt;Connection&gt;());<br><br>    <span class="hljs-comment">//静态代码块，生成10个数据库连接保存到集合中</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            Connection con = JDBCUtils.getConnection();<br>            pool.add(con);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//返回连接池的大小</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pool.size();<br>    &#125;<br><br>    <span class="hljs-comment">//动态代理方式</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(pool.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//从池中获取数据库连接</span><br>            Connection con = pool.remove(<span class="hljs-number">0</span>);<br><br>            Connection proxyCon = (Connection)Proxy.newProxyInstance(con.getClass().getClassLoader(), <span class="hljs-keyword">new</span> Class[]&#123;Connection.class&#125;, <span class="hljs-keyword">new</span> InvocationHandler() &#123;<br>                <span class="hljs-comment">/*</span><br><span class="hljs-comment">                    执行Connection实现类所有方法都会经过invoke</span><br><span class="hljs-comment">                    如果是close方法，则将连接还回池中</span><br><span class="hljs-comment">                    如果不是，直接执行实现类的原有方法</span><br><span class="hljs-comment">                 */</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>                    <span class="hljs-keyword">if</span>(method.getName().equals(<span class="hljs-string">&quot;close&quot;</span>)) &#123;<br>                        pool.add(con);<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                    &#125;<span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">return</span> method.invoke(con,args);<br>                    &#125;<br>                &#125;<br>            &#125;);<br><br>            <span class="hljs-keyword">return</span> proxyCon;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;连接数量已用尽&quot;</span>);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">//从池中返回一个数据库连接</span><br>    <span class="hljs-comment">/*@Override</span><br><span class="hljs-comment">    public Connection getConnection() &#123;</span><br><span class="hljs-comment">        if(pool.size() &gt; 0) &#123;</span><br><span class="hljs-comment">            //从池中获取数据库连接</span><br><span class="hljs-comment">            Connection con = pool.remove(0);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            //通过自定义连接对象进行包装</span><br><span class="hljs-comment">            //MyConnection2 mycon = new MyConnection2(con,pool);</span><br><span class="hljs-comment">            MyConnection3 mycon = new MyConnection3(con,pool);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            //返回包装后的连接对象</span><br><span class="hljs-comment">            return mycon;</span><br><span class="hljs-comment">        &#125;else &#123;</span><br><span class="hljs-comment">            throw new RuntimeException(&quot;连接数量已用尽&quot;);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;*/</span><br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<h4 id="5-开源连接池的使用"><a href="#5-开源连接池的使用" class="headerlink" title="5. 开源连接池的使用"></a>5. 开源连接池的使用</h4><h5 id="5-1-C3P0"><a href="#5-1-C3P0" class="headerlink" title="5.1  C3P0"></a>5.1  C3P0</h5><ul>
<li>C3P0 数据库连接池的使用步骤：<ol>
<li>导入 jar 包：“day02_jdbc高级\资料\C3P0连接池\c3p0-0.9.5.2.jar 和mchange-commons-java-0.2.12.jar”</li>
<li>导入配置文件到 src 目录下： “day02_jdbc高级\资料\C3P0连接池\c3p0-config.xml”<ul>
<li>修改配置文件中的数据库url，用户名和密码</li>
</ul>
</li>
<li>创建 C3P0 连接池对象</li>
<li>获取数据库连接进行使用</li>
<li>注意：C3P0 的配置文件会自动加载，但是必须叫 c3p0-config.xml 或 c3p0-config.properties 。</li>
</ol>
</li>
<li>基本使用：新建com.itheima03.C3P0Test1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima03;<br><br><span class="hljs-keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C3P0Test1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//1.创建c3p0的数据库连接池对象</span><br>        DataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br><br>        <span class="hljs-comment">//2.通过连接池对象获取数据库连接</span><br>        Connection con = dataSource.getConnection();<br><br>        <span class="hljs-comment">//3.执行操作</span><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student&quot;</span>;<br>        PreparedStatement pst = con.prepareStatement(sql);<br><br>        <span class="hljs-comment">//4.执行sql语句，接收结果集</span><br>        ResultSet rs = pst.executeQuery();<br><br>        <span class="hljs-comment">//5.处理结果集</span><br>        <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>            System.out.println(rs.getInt(<span class="hljs-string">&quot;sid&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getString(<span class="hljs-string">&quot;name&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getInt(<span class="hljs-string">&quot;age&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getDate(<span class="hljs-string">&quot;birthday&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">//6.释放资源</span><br>        rs.close();<br>        pst.close();<br>        con.close();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>配置演示：<ul>
<li>在上个案例中，con.close()是将连接归还了么？我们来测试一下：</li>
<li>新建C3P0Test2</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima03;<br><br><span class="hljs-keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C3P0Test2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//1.创建c3p0的数据库连接池对象</span><br>        DataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br><br>        <span class="hljs-comment">//2.测试</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">11</span>; i++) &#123;<br>            Connection con = dataSource.getConnection();<br>            System.out.println(i + <span class="hljs-string">&quot;:&quot;</span> + con);<br><br>            <span class="hljs-keyword">if</span>(i == <span class="hljs-number">5</span>) &#123;<span class="hljs-comment">//如果没有这段代码，我们循环获取11个连接是会报错的，因为我们配置的最大连接数量是10</span><br>                con.close();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<ul>
<li><p>测试：</p>
<p><img src="/2020/05/04/jdbc02/img/c3p0%E6%B5%8B%E8%AF%95.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>添加过if判断之后，就不会报错，然后观察到打印的对象，发现第五个和第六个是一个对象</li>
<li>这说明，close之后，连接是还给连接池了，这样第六个才能继续获取40e0这个对象</li>
</ul>
</li>
</ul>
<h5 id="5-2-Druid"><a href="#5-2-Druid" class="headerlink" title="5.2 Druid"></a>5.2 Druid</h5><ul>
<li>Druid 数据库连接池的使用步骤：<ol>
<li>导入 jar 包：“ day02_jdbc高级\资料\druid-1.0.9\druid-1.0.9.jar”</li>
<li>编写配置文件，放在 src 目录下 ： “day02_jdbc高级\资料\druid-1.0.9\druid.properties”<ul>
<li>修改url，用户名和面</li>
</ul>
</li>
<li>通过 Properties 集合加载配置文件</li>
<li>通过 Druid 连接池工厂类获取数据库连接池对象</li>
<li>获取数据库连接进行使用</li>
<li><strong>注意</strong>：Druid 不会自动加载配置文件，需要我们手动加载，但是文件的名称可以自定义。</li>
</ol>
</li>
<li>基本使用<ul>
<li>新建com.itheima04.DruidTest1</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima04;<br><br><span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    1.通过Properties集合，加载配置文件</span><br><span class="hljs-comment">    2.通过Druid连接池工厂类获取数据库连接池对象</span><br><span class="hljs-comment">    3.通过连接池对象获取数据库连接进行使用</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidTest1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//获取配置文件的流对象</span><br>        InputStream is = DruidTest1.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;druid.properties&quot;</span>);<br><br>        <span class="hljs-comment">//1.通过Properties集合，加载配置文件</span><br>        Properties prop = <span class="hljs-keyword">new</span> Properties();<br>        prop.load(is);<br><br>        <span class="hljs-comment">//2.通过Druid连接池工厂类获取数据库连接池对象</span><br>        DataSource dataSource = DruidDataSourceFactory.createDataSource(prop);<br><br>        <span class="hljs-comment">//3.通过连接池对象获取数据库连接进行使用</span><br>        Connection con = dataSource.getConnection();<br><br><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student&quot;</span>;<br>        PreparedStatement pst = con.prepareStatement(sql);<br><br>        <span class="hljs-comment">//4.执行sql语句，接收结果集</span><br>        ResultSet rs = pst.executeQuery();<br><br>        <span class="hljs-comment">//5.处理结果集</span><br>        <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>            System.out.println(rs.getInt(<span class="hljs-string">&quot;sid&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getString(<span class="hljs-string">&quot;name&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getInt(<span class="hljs-string">&quot;age&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getDate(<span class="hljs-string">&quot;birthday&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">//6.释放资源</span><br>        rs.close();<br>        pst.close();<br>        con.close();<span class="hljs-comment">//也是将连接归还</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>抽取工具类com.itheima.utils.DataSourceUtils</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.utils;<br><br><span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.sql.Statement;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    数据库连接池的工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceUtils</span> </span>&#123;<br>    <span class="hljs-comment">//1.私有构造方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">DataSourceUtils</span><span class="hljs-params">()</span></span>&#123;&#125;<br><br>    <span class="hljs-comment">//2.声明数据源变量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DataSource dataSource;<br><br>    <span class="hljs-comment">//3.提供静态代码块，完成配置文件的加载和获取数据库连接池对象</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//完成配置文件的加载</span><br>            InputStream is = DataSourceUtils.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;druid.properties&quot;</span>);<br><br>            Properties prop = <span class="hljs-keyword">new</span> Properties();<br>            prop.load(is);<br><br>            <span class="hljs-comment">//获取数据库连接池对象</span><br>            dataSource = DruidDataSourceFactory.createDataSource(prop);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//4.提供一个获取数据库连接的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;<br>        Connection con = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            con = dataSource.getConnection();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> con;<br>    &#125;<br><br>    <span class="hljs-comment">//5.提供一个获取数据库连接池对象的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataSource <span class="hljs-title">getDataSource</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br><br>    <span class="hljs-comment">//6.释放资源</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(Connection con, Statement stat, ResultSet rs)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(con != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                con.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(stat != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                stat.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(rs != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                rs.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(Connection con, Statement stat)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(con != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                con.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(stat != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                stat.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<ul>
<li><p>使用工具类</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima04;<br><br><span class="hljs-keyword">import</span> com.itheima.utils.DataSourceUtils;<br><br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidTest2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//1.通过连接池工具类获取一个数据库连接</span><br>        Connection con = DataSourceUtils.getConnection();<br><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student&quot;</span>;<br>        PreparedStatement pst = con.prepareStatement(sql);<br><br>        <span class="hljs-comment">//2.执行sql语句，接收结果集</span><br>        ResultSet rs = pst.executeQuery();<br><br>        <span class="hljs-comment">//3.处理结果集</span><br>        <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>            System.out.println(rs.getInt(<span class="hljs-string">&quot;sid&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getString(<span class="hljs-string">&quot;name&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getInt(<span class="hljs-string">&quot;age&quot;</span>) + <span class="hljs-string">&quot;\t&quot;</span> + rs.getDate(<span class="hljs-string">&quot;birthday&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">//4.释放资源</span><br>        DataSourceUtils.close(con,pst,rs);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h3 id="二、JDBC框架-JDBCTemplate"><a href="#二、JDBC框架-JDBCTemplate" class="headerlink" title="二、JDBC框架(JDBCTemplate)"></a>二、JDBC框架(JDBCTemplate)</h3><h4 id="1-分析前一天案例中的重复代码"><a href="#1-分析前一天案例中的重复代码" class="headerlink" title="1.分析前一天案例中的重复代码"></a>1.分析前一天案例中的重复代码</h4><ul>
<li>dao层的重复代码<ul>
<li>定义必要的信息、获取数据库的连接、释放资源都是重复的代码！</li>
<li>而我们最终的核心功能仅仅只是执行一条sql语句而已啊！</li>
<li>所以我们可以抽取出一个JDBC模板类，来封装一些方法(update、query)，专门帮我们执行增删改查的sql语句！</li>
<li>将之前那些重复的操作，都抽取到模板类中的方法里。就能大大简化我们的使用步骤！</li>
</ul>
</li>
</ul>
<h4 id="2-自定义JDBC框架"><a href="#2-自定义JDBC框架" class="headerlink" title="2.自定义JDBC框架"></a>2.自定义JDBC框架</h4><h5 id="2-1数据库的源信息"><a href="#2-1数据库的源信息" class="headerlink" title="2.1数据库的源信息"></a>2.1数据库的源信息</h5><ul>
<li>DataBaseMetaData(了解)：数据库的源信息<ul>
<li>java.sql.DataBaseMetaData：封装了整个数据库的综合信息</li>
<li>例如：<ul>
<li>String getDatabaseProductName()：获取数据库产品的名称</li>
<li>int getDatabaseProductVersion()：获取数据库产品的版本号</li>
</ul>
</li>
</ul>
</li>
<li>ParameterMetaData：参数的源信息<ul>
<li>java.sql.ParameterMetaData：封装的是预编译执行者对象中每个参数的类型和属性</li>
<li>这个对象可以通过预编译执行者对象中的getParameterMetaData()方法来获取</li>
<li>核心功能：<ul>
<li>int getParameterCount()：获取sql语句中参数的个数</li>
</ul>
</li>
</ul>
</li>
<li>ResultSetMetaData：结果集的源信息<ul>
<li>java.sql.ResultSetMetaData：封装的是结果集对象中列的类型和属性</li>
<li>这个对象可以通过结果集对象中的getMetaData()方法来获取</li>
<li>核心功能：<ul>
<li>int getColumnCount()：获取列的总数</li>
<li>String getColumnName(int i)：获取列名</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-2JDBCTemplate类增删改功能的编写"><a href="#2-2JDBCTemplate类增删改功能的编写" class="headerlink" title="2.2JDBCTemplate类增删改功能的编写"></a>2.2JDBCTemplate类增删改功能的编写</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCTemplate</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br>    <span class="hljs-keyword">private</span> Connection con;<br>    <span class="hljs-keyword">private</span> PreparedStatement pst;<br>    <span class="hljs-keyword">private</span> ResultSet rs;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JDBCTemplate</span><span class="hljs-params">(DataSource dataSource)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.dataSource = dataSource;<br>    &#125;<br><br>    <span class="hljs-comment">//专用于执行增删改sql语句的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(String sql,Object...objs)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> result = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">try</span>&#123;<br>            con = dataSource.getConnection();<br>            pst = con.prepareStatement(sql);<br><br>            <span class="hljs-comment">//获取sql语句中的参数源信息</span><br>            ParameterMetaData pData = pst.getParameterMetaData();<br>            <span class="hljs-comment">//获取sql语句中参数的个数</span><br>            <span class="hljs-keyword">int</span> parameterCount = pData.getParameterCount();<br><br>            <span class="hljs-comment">//判断参数个数是否一致</span><br>            <span class="hljs-keyword">if</span>(parameterCount != objs.length) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;参数个数不匹配&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-comment">//为sql语句中的?占位符赋值</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; objs.length; i++) &#123;<br>                pst.setObject(i+<span class="hljs-number">1</span>,objs[i]);<br>            &#125;<br><br>            <span class="hljs-comment">//执行sql语句</span><br>            result = pst.executeUpdate();<br><br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//释放资源</span><br>            DataSourceUtils.close(con,pst);<br>        &#125;<br><br>        <span class="hljs-comment">//返回结果</span><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<h5 id="2-3JDBCTemplate类查询功能的编写"><a href="#2-3JDBCTemplate类查询功能的编写" class="headerlink" title="2.3JDBCTemplate类查询功能的编写"></a>2.3JDBCTemplate类查询功能的编写</h5><ul>
<li>实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    学生实体类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Integer sid;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Date birthday;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">(Integer sid, String name, Integer age, Date birthday)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.sid = sid;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        <span class="hljs-keyword">this</span>.age = age;<br>        <span class="hljs-keyword">this</span>.birthday = birthday;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getSid</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> sid;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSid</span><span class="hljs-params">(Integer sid)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.sid = sid;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getBirthday</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> birthday;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBirthday</span><span class="hljs-params">(Date birthday)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.birthday = birthday;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;sid=&quot;</span> + sid +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, birthday=&quot;</span> + birthday +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<ul>
<li>ResultSetHandler接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    用于处理结果集的接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ResultSetHandler</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">//处理结果集的抽象方法。</span><br>    &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">handler</span><span class="hljs-params">(ResultSet rs)</span></span>;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<ul>
<li>BeanHandler实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    实现类1：用于完成将查询出来的一条记录，封装到Student对象中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanHandler</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">ResultSetHandler</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">//1.声明对象类型变量</span><br>    <span class="hljs-keyword">private</span> Class&lt;T&gt; beanClass;<br><br>    <span class="hljs-comment">//2.有参构造对变量赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BeanHandler</span><span class="hljs-params">(Class&lt;T&gt; beanClass)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.beanClass = beanClass;<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        将ResultSet结果集中的数据封装到beanClass类型对象中</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">handler</span><span class="hljs-params">(ResultSet rs)</span> </span>&#123;<br>        <span class="hljs-comment">//3.声明对象</span><br>        T bean = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//4.创建传递参数的对象</span><br>            bean = beanClass.newInstance();<br><br>            <span class="hljs-comment">//5.判断是否有结果集</span><br>            <span class="hljs-keyword">if</span>(rs.next()) &#123;<br>                <span class="hljs-comment">//6.得到所有的列名</span><br>                <span class="hljs-comment">//6.1先得到结果集的源信息</span><br>                ResultSetMetaData rsmd = rs.getMetaData();<br>                <span class="hljs-comment">//6.2还要得到有多少列</span><br>                <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>                <span class="hljs-comment">//6.3遍历列数</span><br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= columnCount; i++) &#123;<br>                    <span class="hljs-comment">//6.4得到每列的列名</span><br>                    String columnName = rsmd.getColumnName(i);<br>                    <span class="hljs-comment">//6.5通过列名获取数据</span><br>                    Object columnValue = rs.getObject(columnName);<br><br>                    <span class="hljs-comment">//6.6列名其实就是对象中成员变量的名称。于是就可以使用列名得到对象中属性的描述器(get和set方法)</span><br>                    PropertyDescriptor pd = <span class="hljs-keyword">new</span> PropertyDescriptor(columnName.toLowerCase(),beanClass);<br>                    <span class="hljs-comment">//6.7获取set方法</span><br>                    Method writeMethod = pd.getWriteMethod();<br>                    <span class="hljs-comment">//6.8执行set方法，给成员变量赋值</span><br>                    writeMethod.invoke(bean,columnValue);<br>                &#125;<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-comment">//7.将对象返回</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<ul>
<li>BeanListHandler实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    实现类2：用于将结果集封装到集合中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanListHandler</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">ResultSetHandler</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br><br>    <span class="hljs-comment">//1.声明对象变量</span><br>    <span class="hljs-keyword">private</span> Class&lt;T&gt; beanClass;<br><br>    <span class="hljs-comment">//2.有参构造为变量赋值</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BeanListHandler</span><span class="hljs-params">(Class&lt;T&gt; beanClass)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.beanClass = beanClass;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title">handler</span><span class="hljs-params">(ResultSet rs)</span> </span>&#123;<br>        <span class="hljs-comment">//3.创建集合对象</span><br>        List&lt;T&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//4.遍历结果集对象</span><br>            <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>                <span class="hljs-comment">//5.创建传递参数的对象</span><br>                T bean = beanClass.newInstance();<br>                <span class="hljs-comment">//6.得到所有的列名</span><br>                <span class="hljs-comment">//6.1先得到结果集的源信息</span><br>                ResultSetMetaData rsmd = rs.getMetaData();<br>                <span class="hljs-comment">//6.2还要得到有多少列</span><br>                <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>                <span class="hljs-comment">//6.3遍历列数</span><br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= columnCount; i++) &#123;<br>                    <span class="hljs-comment">//6.4得到每列的列名</span><br>                    String columnName = rsmd.getColumnName(i);<br>                    <span class="hljs-comment">//6.5通过列名获取数据</span><br>                    Object columnValue = rs.getObject(columnName);<br><br>                    <span class="hljs-comment">//6.6列名其实就是对象中成员变量的名称。于是就可以使用列名得到对象中属性的描述器(get和set方法)</span><br>                    PropertyDescriptor pd = <span class="hljs-keyword">new</span> PropertyDescriptor(columnName.toLowerCase(),beanClass);<br>                    <span class="hljs-comment">//6.7获取set方法</span><br>                    Method writeMethod = pd.getWriteMethod();<br>                    <span class="hljs-comment">//6.8执行set方法，给成员变量赋值</span><br>                    writeMethod.invoke(bean,columnValue);<br>                &#125;<br>                <span class="hljs-comment">//7.将对象保存到集合中</span><br>                list.add(bean);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//8.返回结果</span><br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<ul>
<li>ScalarHandler实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    实现类3：用于返回一个聚合函数的查询结果</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScalarHandler</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">ResultSetHandler</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">handler</span><span class="hljs-params">(ResultSet rs)</span> </span>&#123;<br>        <span class="hljs-comment">//1.声明一个变量</span><br>        Long value = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//2.判断是否有结果</span><br>            <span class="hljs-keyword">if</span>(rs.next()) &#123;<br>                <span class="hljs-comment">//3.获取结果集的源信息</span><br>                ResultSetMetaData rsmd = rs.getMetaData();<br>                <span class="hljs-comment">//4.获取第一列的列名</span><br>                String columnName = rsmd.getColumnName(<span class="hljs-number">1</span>);<br>                <span class="hljs-comment">//5.根据列名获取值</span><br>                value = rs.getLong(columnName);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//6.将结果返回</span><br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<ul>
<li>JDBCTemplate类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCTemplate</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br>    <span class="hljs-keyword">private</span> Connection con;<br>    <span class="hljs-keyword">private</span> PreparedStatement pst;<br>    <span class="hljs-keyword">private</span> ResultSet rs;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JDBCTemplate</span><span class="hljs-params">(DataSource dataSource)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.dataSource = dataSource;<br>    &#125;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    	专用于执行聚合函数sql语句的方法</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">queryForScalar</span><span class="hljs-params">(String sql, ResultSetHandler&lt;Long&gt; rsh, Object...objs)</span> </span>&#123;<br>        Long result = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            con = dataSource.getConnection();<br>            pst = con.prepareStatement(sql);<br><br>            <span class="hljs-comment">//获取sql语句中的参数源信息</span><br>            ParameterMetaData pData = pst.getParameterMetaData();<br>            <span class="hljs-keyword">int</span> parameterCount = pData.getParameterCount();<br><br>            <span class="hljs-comment">//判断参数个数是否一致</span><br>            <span class="hljs-keyword">if</span>(parameterCount != objs.length) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;参数个数不匹配&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-comment">//为sql语句中的?占位符赋值</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; objs.length; i++) &#123;<br>                pst.setObject(i+<span class="hljs-number">1</span>,objs[i]);<br>            &#125;<br><br>            <span class="hljs-comment">//执行sql语句</span><br>            rs = pst.executeQuery();<br><br>            <span class="hljs-comment">//通过ScalarHandler方式对结果进行处理</span><br>            result = rsh.handler(rs);<br><br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//释放资源</span><br>            DataSourceUtils.close(con,pst,rs);<br>        &#125;<br><br>        <span class="hljs-comment">//将结果返回</span><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    	专用于查询所有记录sql语句的方法</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">queryForList</span><span class="hljs-params">(String sql, ResultSetHandler&lt;T&gt; rsh, Object...objs)</span> </span>&#123;<br>        List&lt;T&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">try</span>&#123;<br>            con = dataSource.getConnection();<br>            pst = con.prepareStatement(sql);<br><br>            <span class="hljs-comment">//获取sql语句中的参数源信息</span><br>            ParameterMetaData pData = pst.getParameterMetaData();<br>            <span class="hljs-keyword">int</span> parameterCount = pData.getParameterCount();<br><br>            <span class="hljs-comment">//判断参数个数是否一致</span><br>            <span class="hljs-keyword">if</span>(parameterCount != objs.length) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;参数个数不匹配&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-comment">//为sql语句中的?占位符赋值</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; objs.length; i++) &#123;<br>                pst.setObject(i+<span class="hljs-number">1</span>,objs[i]);<br>            &#125;<br><br>            <span class="hljs-comment">//执行sql语句</span><br>            rs = pst.executeQuery();<br><br>            <span class="hljs-comment">//通过BeanListHandler方式对结果进行处理</span><br>            list = rsh.handler(rs);<br><br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//释放资源</span><br>            DataSourceUtils.close(con,pst,rs);<br>        &#125;<br><br>        <span class="hljs-comment">//将结果返回</span><br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    	专用于执行查询一条记录sql语句的方法</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">queryForObject</span><span class="hljs-params">(String sql, ResultSetHandler&lt;T&gt; rsh, Object...objs)</span> </span>&#123;<br>        T obj = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            con = dataSource.getConnection();<br>            pst = con.prepareStatement(sql);<br><br>            <span class="hljs-comment">//获取sql语句中的参数源信息</span><br>            ParameterMetaData pData = pst.getParameterMetaData();<br>            <span class="hljs-keyword">int</span> parameterCount = pData.getParameterCount();<br><br>            <span class="hljs-comment">//判断参数个数是否一致</span><br>            <span class="hljs-keyword">if</span>(parameterCount != objs.length) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;参数个数不匹配&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-comment">//为sql语句中的?占位符赋值</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; objs.length; i++) &#123;<br>                pst.setObject(i+<span class="hljs-number">1</span>,objs[i]);<br>            &#125;<br><br>            <span class="hljs-comment">//执行sql语句</span><br>            rs = pst.executeQuery();<br><br>            <span class="hljs-comment">//通过BeanHandler方式对结果进行处理</span><br>            obj = rsh.handler(rs);<br><br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//释放资源</span><br>            DataSourceUtils.close(con,pst,rs);<br>        &#125;<br><br>        <span class="hljs-comment">//将结果返回</span><br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>

<h5 id="2-4测试自定义JDBC框架的使用"><a href="#2-4测试自定义JDBC框架的使用" class="headerlink" title="2.4测试自定义JDBC框架的使用"></a>2.4测试自定义JDBC框架的使用</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCTemplateTest</span> </span>&#123;<br>    <span class="hljs-comment">//创建JDBCTemplate对象</span><br>    JDBCTemplate template = <span class="hljs-keyword">new</span> JDBCTemplate(DataSourceUtils.getDataSource());<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectScalar</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//查询student表的记录条数</span><br>        String sql = <span class="hljs-string">&quot;SELECT COUNT(*) FROM student&quot;</span>;<br>        Long count = template.queryForScalar(sql, <span class="hljs-keyword">new</span> ScalarHandler&lt;Long&gt;());<br>        System.out.println(count);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectAll</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//查询所有学生信息</span><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student&quot;</span>;<br>        List&lt;Student&gt; list = template.queryForList(sql, <span class="hljs-keyword">new</span> BeanListHandler&lt;Student&gt;(Student.class));<br>        <span class="hljs-keyword">for</span>(Student stu : list) &#123;<br>            System.out.println(stu);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectOne</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//查询张三这条记录</span><br>        String sql = <span class="hljs-string">&quot;SELECT * FROM student WHERE sid=?&quot;</span>;<br>        <span class="hljs-comment">//通过BeanHandler将结果封装成一个Student对象</span><br>        Student stu = template.queryForObject(sql, <span class="hljs-keyword">new</span> BeanHandler&lt;Student&gt;(Student.class), <span class="hljs-number">1</span>);<br>        System.out.println(stu);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//新增周七记录</span><br>        String sql = <span class="hljs-string">&quot;INSERT INTO student VALUES (?,?,?,?)&quot;</span>;<br>        Object[] params = &#123;<span class="hljs-number">5</span>,<span class="hljs-string">&quot;周七&quot;</span>,<span class="hljs-number">27</span>,<span class="hljs-string">&quot;2007-07-07&quot;</span>&#125;;<br>        <span class="hljs-keyword">int</span> result = template.update(sql, params);<br>        System.out.println(result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//删除周七这条记录</span><br>        String sql = <span class="hljs-string">&quot;DELETE FROM student WHERE sid=?&quot;</span>;<br>        <span class="hljs-keyword">int</span> result = template.update(sql, <span class="hljs-number">5</span>);<br>        System.out.println(result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//修改张三的年龄为33</span><br>        String sql = <span class="hljs-string">&quot;UPDATE student SET age=? WHERE name=?&quot;</span>;<br>        Object[] params = &#123;<span class="hljs-number">33</span>,<span class="hljs-string">&quot;张三&quot;</span>&#125;;<br>        <span class="hljs-keyword">int</span> result = template.update(sql,params);<br>        System.out.println(result);<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/JDBC/">JDBC</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/JDBC/">JDBC</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/05/04/mysql04/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MySQL高级-04</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/05/04/Javaweb04/">
                        <span class="hidden-mobile">Cookie&Session& Jsp</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.lazyComments('valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#valine",
          app_id: "7FicXKczRMSUD3slGCpiLLto-gzGzoHsz",
          app_key: "L7N1wkygdm2UHsrq5DHTuMMk",
          placeholder: "说点什么",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: true,
          serverURLs: "https://7ficxkcz.lc-cn-n1-shared.com",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a target="_blank" href="https://www.12377.cn/" rel="nofollow noopener noopener">中央网信办（国家互联网信息办公室）违法和不良信息举报中心</a>

  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        京ICP证123456号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
            
            <span>京公网安备12345678号</span>
          </a>
        </span>
      
    
  </div>


  
  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  








  

  

  

  

  
    <!-- 51.la Analytics -->
    <script defer type="text/javascript" src="//js.users.51.la/21111747.js"></script>
  

  




  
<script src="/js/caidai.js"></script>
<script src="/js/dianjichuzi.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>

  <script type="text/javascript" src="//js.users.51.la/21111747.js"></script>
</body>
</html>
